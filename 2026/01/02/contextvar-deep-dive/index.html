<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="blog, decade, lucky">
    <meta name="description" content="Decade&#39;s lucky blog">
    <meta name="author" content="Zhongjun Qiu">
    
    <title>
        
            ContextVaråº•å±‚å®ç°æ·±åº¦è§£æï¼šä»åŸç†åˆ°å®æˆ˜ |
        
        Decade
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="https://decade.net.cn/images/logo.ico">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/regular.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/solid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/font/css/brands.min.css">
    
        
            
        
            
                
<link rel="stylesheet" href="/css/custom.css">

            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"decade.net.cn","root":"/","language":"en","path":"search.json"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"Decade","author":"Zhongjun Qiu","avatar":"/images/avatar.ico","logo":"/images/avatar.ico","favicon":"https://decade.net.cn/images/logo.ico"},"menu":{"home":"/ || fa-solid fa-home","archives":"/archives || fa-solid fa-box-archive","tags":"/tags || fa-solid fa-tags","categories":"/categories || fa-solid fa-layer-group","more":{"icon":"fa-solid fa-circle-user","children":[{"tool":"/tools || fa-solid fa-tools"},{"life":"/photos || fa-solid fa-image"},{"me":"/about || fa-solid fa-user-graduate"},{"Git":"/custom/index.html || fa-solid fa-user"}]}},"first_screen":{"enable":true,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"The Steadfast Determination of An Ordinary Soul.","hitokoto":false},"social_contact":{"enable":true,"links":{"github":"https://github.com/Decade-qiu","weixin":"img | /images/social/weixin.jpg","qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":"https://x.com/LukasMa46743746","facebook":null,"email":"qiuyu6021@gmail.com"}},"scroll":{"progress_bar":true,"percent":true,"hide_header":false},"home":{"announcement":null,"category":true,"tag":true,"post_datetime":"created || fa-solid fa-history","post_datetime_format":"ago"},"post":{"author_badge":{"enable":true,"level_badge":false,"custom_badge":"å…ƒå©´å¼€å‘è€…"},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":true,"img_link":"/images/post/payment.jpg","text":null,"icon":null},"created_datetime_icon":"fa-solid fa-calendar-plus","updated_datetime_icon":"fa-solid fa-arrows-rotate"},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"obsidian"},"toc":{"enable":true,"number":false,"expand_all":false,"init_open":false,"layout":"right"},"website_count":{"busuanzi_count":{"enable":true,"site_uv":false,"site_pv":true,"page_pv":true}},"local_search":{"enable":true,"preload":true},"comment":{"enable":true,"use":"waline","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.39"},"waline":{"server_url":"https://waline-vercel-two-rho.vercel.app/","reaction":true,"version":"3.3.2"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":true},"cdn":{"enable":true,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2020,"word_count":true,"site_deploy":{"enable":true,"provider":"github","url":"https://github.com"},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":true,"css":[null,"/css/custom.css"],"js":[null,"/js/custom_code_block.js"]},"root":"","source_data":{"photos":[{"url":"/images/post/ã€å“²é£å£çº¸ã€‘æ—¥æœ¬åŠ¨æ¼«-ç”µé”¯äºº.webp","name":"ç”µé”¯äºº"},{"url":"/images/post/Quicker_20250428_193139.webp","name":"kowayia"},{"url":"/images/post/Quicker_20250428_233349.webp","name":"ä¸–ç•Œåœ°å›¾"},{"url":"/images/post/tmpFE1E.tmp.webp","name":"æ–½çº¢"},{"url":"/images/post/result-1745849388402.webp","name":"ä»‡å¿ éª.åŠ¨æ¼«ç‰ˆ"},{"url":"/images/photos/çŒ«çŒ«å›°äº†PNG.png","name":"çŒ«çŒ«å›°äº†PNG"},{"url":"/images/photos/å®é™çš„æš´é›¨å¤©.png","name":"å®é™çš„æš´é›¨å¤©"},{"url":"/images/photos/æˆ‘åœ¨æ‰¬å·å¥½æƒ³ä½ .png","name":"æˆ‘åœ¨æ‰¬å·å¥½æƒ³ä½ "},{"url":"/images/photos/ä¿¡é¸½.png","name":"ä¿¡é¸½"},{"url":"/images/photos/å•¤é…’çƒ§çƒ¤.png","name":"å•¤é…’çƒ§çƒ¤"},{"url":"/images/photos/éšæ‰‹æ‹.png","name":"éšæ‰‹æ‹"},{"url":"/images/photos/ç³–æ²¹æ··åˆç‚¸å¼¹.png","name":"ç³–æ²¹æ··åˆç‚¸å¼¹"},{"url":"/images/photos/é¦™é¦™çš„.png","name":"é¦™é¦™çš„"},{"url":"/images/photos/èå­è±è±.png","name":"èå­è±è±"},{"url":"/images/post/æŒ‡Cä¸ºpython.png","name":"æŒ‡Cä¸ºpython"},{"url":"/images/photos/YangZhou_Station.png","name":"YangZhou Station"},{"url":"/images/photos/GBC.jpg","name":"Girls Band Cry"},{"url":"/images/photos/bocchi.webp","name":"Bocchi the Rock!"}],"tools":[{"category":"AIGC","anchorId":"QUlHQw0"},{"name":"ChatGPT","link":"https://chat.openai.com/","description":"OpenAI æ——ä¸‹ AI èŠå¤©å¯¹è¯å·¥å…·","image":"/images/tools/chatgpt.svg"},{"name":"Gemini","link":"https://gemini.google.com/app","description":"Google æ——ä¸‹ AI èŠå¤©å¯¹è¯å·¥å…·","image":"/images/tools/gemini.svg"},{"name":"Copilot","link":"https://copilot.microsoft.com/","description":"Microsoft æ——ä¸‹ AI èŠå¤©å¯¹è¯å·¥å…·","image":"/images/tools/copilot.png"},{"name":"Deepseek","link":"https://chat.deepseek.com/","description":"Deepseek æ——ä¸‹ AI èŠå¤©å¯¹è¯å·¥å…·","image":"/images/tools/deepseek.jpg"},{"name":"Qwen","link":"https://chat.qwen.ai/","description":"Alibaba æ——ä¸‹ AI èŠå¤©å¯¹è¯å·¥å…·","image":"/images/tools/tongyiqianwen.svg"},{"name":"å³æ¢¦AI","link":"https://jimeng.jianying.com/ai-tool/home","description":"Dreamina å›¾åƒç”Ÿæˆå·¥å…·","image":"/images/tools/dream.png"},{"name":"komiko","link":"https://komiko.app/home","description":"Komiko åŠ¨æ¼«åŒ–AIå·¥å…·","image":"/images/tools/komiko.webp"},{"name":"InsMind","link":"https://www.insmind.com/zh-cn/workspace/","description":"AIå›¾ç‰‡ç¼–è¾‘å·¥å…·","image":"/images/tools/insmind.svg"},{"name":"Raphael","link":"https://raphael.app/zh","description":"AIå›¾ç‰‡ç”Ÿæˆå·¥å…·","image":"/images/tools/rap.png"},{"name":"è…¾è®¯å…ƒå®","link":"https://yuanbao.tencent.com/chat/","description":"Tencent æ——ä¸‹ AI èŠå¤©å¯¹è¯å·¥å…·","image":"/images/tools/tencent.jpg"},{"name":"è±†åŒ…","link":"https://www.doubao.com/chat/","description":"å­—èŠ‚è·³åŠ¨ å›¾ç‰‡ç”Ÿæˆå·¥å…·","image":"/images/tools/dn.jpg"},{"category":"Airport","anchorId":"QWlycG9ydA12"},{"name":"ç‹¬è§’å…½","link":"https://91unicorn.cloud/","description":"ååˆ†ç¨³å®š","image":"/images/tools/dujiaoshou.ico"},{"name":"æé€Ÿæœºåœº","link":"https://xn--mes358acgm99l.com/","description":"ä¾¿å®œå¥½ç”¨","image":"/images/tools/jisu.ico"},{"name":"iKuuu","link":"https://ikuuu.org/user","description":"ä»¥å¤‡ä¸æ—¶ä¹‹éœ€","image":"/images/tools/ikuu.ico"},{"category":"File Converter","anchorId":"RmlsZSUyMENvbnZlcnRlcg16"},{"name":"Online Image Tool","link":"https://www.onlineimagetool.com/zh/","description":"åœ¨çº¿å‹ç¼©å’Œè½¬æ¢å›¾ç‰‡","image":"/images/tools/oit.png"},{"name":"Vector Magic","link":"https://zh.vectormagic.com/","description":"æ–‡ä»¶çŸ¢é‡åŒ–","image":"/images/tools/apple-touch-icon-180_97956a9f5fbf6a767de100280d78c1f8.png"},{"name":"TinyPNG","link":"https://tinypng.com/","description":"Smart AVIF, WebP, PNG and JPEG Compression for Faster Websites","image":"/images/tools/tiny.ico"},{"name":"è¸å¾—","link":"https://techbrood.com/tool","description":"HTML5åœ¨çº¿å·¥å…·","image":"/images/tools/td.ico"},{"name":"UUåœ¨çº¿å·¥å…·","link":"https://uutool.cn/base64/","description":"base64å·¥å…·åŒ…","image":"/images/tools/uu.png"},{"name":"I Love PDF","link":"https://www.ilovepdf.com/","description":"PDFå·¥å…·åŒ…","image":"/images/tools/ilovepdf.svg"},{"category":"Free GPT API","anchorId":"RnJlZSUyMEdQVCUyMEFQSQ23"},{"name":"Gemini API","link":"https://ai.google.dev/gemini-api/docs/quickstart?lang=python","description":"Google Gemini API","image":"/images/tools/touchicon-180-new.png"},{"name":"SiliconCloud","link":"https://cloud.siliconflow.cn/models","description":"å„ç§æ¨¡å‹API"},{"name":"Cloudflare Workers AI","link":"https://developers.cloudflare.com/workers-ai/configuration/open-ai-compatibility/","description":"OpenAI compatible API endpoints","image":"/images/tools/logo.p_ySeMR1.svg"},{"name":"ç®—äº†ä¹ˆ","link":"https://api.suanli.cn/","description":"å…±äº«ç®—åŠ›API","image":"/images/tools/suanlm.svg"},{"category":"Resource Explorer","anchorId":"UmVzb3VyY2UlMjBFeHBsb3Jlcg28"},{"name":"Free for Developers","link":"https://free-for.dev/","description":"A list of SaaS, PaaS and IaaS offerings that have free tiers of interest to devops and infradev","image":"/images/tools/freefd.webp"},{"name":"zlibrary","link":"https://zh.z-library.sk/","description":"åœ¨çº¿å›¾ä¹¦é¦†","image":"/images/tools/logo.zlibrary.svg"},{"name":"PicX","link":"https://picx.xpoet.cn/","description":"åŸºäºGithubçš„å›¾åºŠ","image":"/images/tools/logo.ffee4291.png"},{"name":"HaoWallpaper","link":"https://haowallpaper.com/","description":"å“²é£å£çº¸","image":"/images/tools/haowall.ico"},{"name":"Awesome","link":"https://wallhaven.cc/","description":"WallHaven","image":"/images/tools/wallheaven.ico"},{"name":"WallHere","link":"https://wallhere.com/","description":"WallHere"},{"name":"SnapAny","link":"https://snapany.com/zh","description":"ä¸‡èƒ½è§†é¢‘å›¾ç‰‡è§£æä¸‹è½½"},{"name":"Ã˜Magnet","link":"https://0cili.org/","description":"ç§å­ä¸‹è½½"},{"name":"twitter","link":"https://snapvid.net/zh-cn/twitter-downloader","description":"æ¨ç‰¹è§†é¢‘ä¸‹è½½å™¨","image":"/images/tools/apple-touch-icon.png"},{"name":"youtube","link":"https://www.y2mate.com/en949","description":"Youtubeè§†é¢‘ä¸‹è½½å™¨","image":"/images/tools/y2mate.webp"},{"name":"Icons8","link":"https://icons8.com/icons","description":"å…è´¹å›¾æ ‡ä¸‹è½½","image":"/images/tools/logo-icons8.svg"},{"name":"å…¨èƒ½emoji","link":"https://www.emojiall.com/zh-hans","description":"emojiåˆ¶ä½œ","image":"/images/tools/emoji.ico"},{"name":"emojidb","link":"https://emojidb.org/","description":"å…è´¹è¡¨æƒ…åŒ…ä¸‹è½½","image":"/images/tools/emojidb.png"},{"name":"Flaticon","link":"https://www.flaticon.com/","description":"å…è´¹å›¾æ ‡ä¸‹è½½","image":"/images/tools/logo-flaticon.svg"},{"name":"IconFinder","link":"https://www.iconfinder.com/","description":"å…è´¹å›¾æ ‡ä¸‹è½½","image":"/images/tools/logo-iconfinder.svg"}]},"version":"4.2.5"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left flex-start border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/avatar.ico">
                </a>
            
            <a class="site-name border-box" href="/">
               Decade
            </a>
        </div>

        <div class="right border-box">
            <div class="pc border-box">
                <ul class="menu-list border-box">
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-home"></i>
                                
                                HOME
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/archives">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                
                                ARCHIVES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/tags">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-tags"></i>
                                
                                TAGS
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box">
                            <a class="menu-text-color border-box" href="/categories">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                
                                CATEGORIES
                                
                            </a>
                            
                        </li>
                    
                        
                        <li class="menu-item flex-start border-box has-sub-menu">
                            <a class="menu-text-color border-box" href="javascript:void(0);">
                                
                                    <i class="menu-text-color menu-icon fa-solid fa-circle-user"></i>
                                
                                MORE
                                
                                    <i class="menu-text-color collapse-icon fa-solid fa-angle-down"></i>
                                
                            </a>
                            
                                <ul class="sub-menu-list border-box">
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/tools">
                                                
                                                    <i class="menu-text-color sub-menu-icon fa-solid fa-tools"></i>
                                                
                                                TOOL
                                            </a>
                                        </li>
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/photos">
                                                
                                                    <i class="menu-text-color sub-menu-icon fa-solid fa-image"></i>
                                                
                                                LIFE
                                            </a>
                                        </li>
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/about">
                                                
                                                    <i class="menu-text-color sub-menu-icon fa-solid fa-user-graduate"></i>
                                                
                                                ME
                                            </a>
                                        </li>
                                    
                                        
                                        <li class="sub-menu-item border-box ">
                                            <a class="menu-text-color border-box flex-start" href="/custom/">
                                                
                                                    <i class="menu-text-color sub-menu-icon fa-solid fa-user"></i>
                                                
                                                GIT
                                            </a>
                                        </li>
                                    
                                </ul>
                            
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="menu-text-color fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile border-box flex-start">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list border-box">
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-home"></i>
                                </span>
                            
                            HOME
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/archives">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-box-archive"></i>
                                </span>
                            
                            ARCHIVES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/tags">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-tags"></i>
                                </span>
                            
                            TAGS
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box not-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="/categories">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-layer-group"></i>
                                </span>
                            
                            CATEGORIES
                        </a>
                        
                    </label>
                    
                </li>
            
                
                <li class="drawer-menu-item border-box has-sub-menu">
                    <label class="drawer-menu-label border-box">
                        <a class="drawer-menu-text-color left-side flex-start border-box" href="javascript:void(0);">
                            
                                <span class="menu-icon-wrap border-box flex-center">
                                    <i class="drawer-menu-text-color menu-icon fa-solid fa-circle-user"></i>
                                </span>
                            
                            MORE
                        </a>
                        
                            <i class="right-side collapse-icon fa-solid fa-angle-left"></i>
                        
                    </label>
                    
                        <ul class="drawer-sub-menu-list border-box">
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/tools">
                                        
                                            <span class="sub-menu-icon-wrap border-box flex-center">
                                                <i class="drawer-menu-text-color sub-menu-icon fa-solid fa-tools"></i>
                                            </span>
                                        
                                        TOOL
                                    </a>
                                </li>
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/photos">
                                        
                                            <span class="sub-menu-icon-wrap border-box flex-center">
                                                <i class="drawer-menu-text-color sub-menu-icon fa-solid fa-image"></i>
                                            </span>
                                        
                                        LIFE
                                    </a>
                                </li>
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/about">
                                        
                                            <span class="sub-menu-icon-wrap border-box flex-center">
                                                <i class="drawer-menu-text-color sub-menu-icon fa-solid fa-user-graduate"></i>
                                            </span>
                                        
                                        ME
                                    </a>
                                </li>
                            
                                
                                <li class="sub-menu-item border-box">
                                    <a class="drawer-menu-text-color border-box flex-start" href="/custom/">
                                        
                                            <span class="sub-menu-icon-wrap border-box flex-center">
                                                <i class="drawer-menu-text-color sub-menu-icon fa-solid fa-user"></i>
                                            </span>
                                        
                                        GIT
                                    </a>
                                </li>
                            
                        </ul>
                    
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        ContextVaråº•å±‚å®ç°æ·±åº¦è§£æï¼šä»åŸç†åˆ°å®æˆ˜
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/avatar.ico">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">Zhongjun Qiu</span>
                                
                                    <span class="author-badge">å…ƒå©´å¼€å‘è€…</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2026-01-02 00:00:00</span>
            </span>

            
                <span class="meta-info-item post-update-date">
                    <i class="icon fa-solid fa-arrows-rotate"></i>&nbsp;
                    <span class="datetime" data-updated="Mon Jan 19 2026 18:30:42 GMT+0800">2026-01-19 18:30:42</span>
                </span>
            
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/">æŠ€æœ¯ç¬”è®°</a></li>
                        
                    
                            <li class="category-item">&nbsp;<i class="icon fas fa-angle-right"></i>&nbsp;<a href="/categories/%E9%9D%A2%E8%AF%95/">é¢è¯•</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">å¼‚æ­¥ç¼–ç¨‹</a></li>
                        
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/ContextVar/">ContextVar</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item post-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>3.5k Words</span>
            </span>
        
        
            <span class="meta-info-item post-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>13 Mins</span>
            </span>
        
        
            <span class="meta-info-item post-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    
                         <h2 id="æ ¸å¿ƒæ´å¯Ÿ">æ ¸å¿ƒæ´å¯Ÿ</h2>
<p>Javaçš„ThreadLocalç»‘åœ¨çº¿ç¨‹ä¸Šï¼ŒPythonçš„ContextVarç»‘åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸Šã€‚åœ¨åç¨‹æ—¶ä»£ï¼Œä¸€æ¡çº¿ç¨‹ä¼šå¹¶å‘æ‰§è¡Œå¤šä¸ªTaskï¼Œå¦‚æœç»§ç»­ç”¨ThreadLocalå­˜å‚¨ä¸Šä¸‹æ–‡ï¼ŒTaskä¹‹é—´ä¼šäº’ç›¸è¦†ç›–ã€‚ContextVaré€šè¿‡â€åç¨‹åˆ›å»ºæ—¶å¤åˆ¶Contextâ€çš„æœºåˆ¶ï¼Œå®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æContextVarçš„åº•å±‚å®ç°æœºåˆ¶ï¼Œå¹¶ä¸ThreadLocalè¿›è¡Œæœ¬è´¨å¯¹æ¯”ã€‚</p>
<span id="more"></span>
<h2 id="ä¸€ä¸ºä»€ä¹ˆéœ€è¦-contextvar">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ ContextVarï¼Ÿ</h2>
<h3 id="ä¼ ç»Ÿæ¨¡å‹çš„é—®é¢˜">1.1 ä¼ ç»Ÿæ¨¡å‹çš„é—®é¢˜</h3>
<p>åœ¨ async/await + å¤šä»»åŠ¡å¹¶å‘çš„ Python ç¨‹åºä¸­ï¼š</p>
<ul>
<li><strong>åŒä¸€ä¸ªçº¿ç¨‹é‡Œ</strong>ä¼šå¹¶å‘æ‰§è¡Œå¤šä¸ª Task / Coroutine</li>
<li><strong>ä¸èƒ½ç”¨ <code>threading.local()</code>
æ¥éš”ç¦»ä¸Šä¸‹æ–‡</strong></li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread-1</span><br><span class="line"> â”œâ”€ Task-A (user_id=1)</span><br><span class="line"> â””â”€ Task-B (user_id=2)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœç”¨ <code>threading.local()</code>ï¼š - Task-A / Task-B
ä¼š<strong>äº’ç›¸è¦†ç›–å˜é‡</strong></p>
<h3 id="contextvar-çš„è®¾è®¡ç›®æ ‡">1.2 ContextVar çš„è®¾è®¡ç›®æ ‡</h3>
<p><code>ContextVar</code> çš„ç›®æ ‡æ˜¯ï¼š</p>
<blockquote>
<p><strong>è®©â€ä¸Šä¸‹æ–‡å˜é‡â€ç»‘å®šåˆ°ã€Œå½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆTask /
åç¨‹è°ƒç”¨é“¾ï¼‰ã€è€Œä¸æ˜¯çº¿ç¨‹</strong></p>
</blockquote>
<p>è¿™æ­£æ˜¯ä½ åœ¨ LLM è°ƒç”¨é“¾è¿½è¸ªã€Agent / Tool äº¤ç»‡ã€async +
å¹¶å‘åœºæ™¯ä¸‹éœ€è¦çš„ç‰¹æ€§ã€‚</p>
<h2 id="äºŒcontextvar-çš„æŠ½è±¡æ¨¡å‹">äºŒã€ContextVar çš„æŠ½è±¡æ¨¡å‹</h2>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ">2.1 æ ¸å¿ƒæ¦‚å¿µ</h3>
<p>Python å¯¹ <code>ContextVar</code> çš„è¯­ä¹‰å®šä¹‰æ˜¯ï¼š</p>
<blockquote>
<p><strong>ContextVar çš„å€¼å±äºä¸€ä¸ª
Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œè€Œä¸æ˜¯å±äºå˜é‡æœ¬èº«</strong></p>
</blockquote>
<p>å…³é”®æ¦‚å¿µæœ‰ä¸‰ä¸ªï¼š</p>
<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ContextVar</code></td>
<td>ä¸€ä¸ªâ€å˜é‡å£°æ˜â€ï¼ˆkeyï¼‰</td>
</tr>
<tr>
<td><code>Context</code></td>
<td>å½“å‰æ‰§è¡Œç¯å¢ƒä¸­çš„ä¸€ç»„å˜é‡æ˜ å°„</td>
</tr>
<tr>
<td><code>Context.run()</code></td>
<td>åœ¨æŸä¸ª Context ä¸‹æ‰§è¡Œä»£ç </td>
</tr>
</tbody>
</table>
<h3 id="æŠ½è±¡ç»“æ„">2.2 æŠ½è±¡ç»“æ„</h3>
<p>ä½ å¯ä»¥ç†è§£ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Context</span><br><span class="line"> â”œâ”€ llm_context -&gt; LLMCallContext(...)</span><br><span class="line"> â”œâ”€ request_id  -&gt; xxx</span><br><span class="line"> â””â”€ trace_id    -&gt; yyy</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æŠ½è±¡è®¾è®¡ä½¿å¾— ContextVar
èƒ½å¤Ÿåœ¨åç¨‹/ä»»åŠ¡é“¾ä¸­æ­£ç¡®ä¼ é€’å’Œéš”ç¦»ä¸Šä¸‹æ–‡ã€‚</p>
<h2 id="ä¸‰contextvar-çš„åº•å±‚å®ç°æœºåˆ¶">ä¸‰ã€ContextVar çš„åº•å±‚å®ç°æœºåˆ¶</h2>
<h3 id="context-æœ¬è´¨æ˜¯ä»€ä¹ˆ">3.1 Context æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>åœ¨ CPython ä¸­ï¼š</p>
<ul>
<li><strong>æ¯ä¸ªæ‰§è¡Œå•å…ƒï¼ˆçº¿ç¨‹ / asyncio Taskï¼‰</strong>éƒ½ç»‘å®šç€ä¸€ä¸ª
<strong>Context å¯¹è±¡</strong></li>
</ul>
<p>è¿™ä¸ª Context å†…éƒ¨ç»“æ„å¯ä»¥æŠ½è±¡æˆï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span>:</span><br><span class="line">    data: <span class="built_in">dict</span>[ContextVar, <span class="type">Any</span>]</span><br></pre></td></tr></table></figure>
<p><strong>é‡ç‚¹</strong>ï¼šContext
<strong>ä¸æ˜¯å…¨å±€çš„ï¼Œä¹Ÿä¸æ˜¯çº¿ç¨‹å”¯ä¸€çš„</strong>ï¼Œè€Œæ˜¯
<strong>å¯ä»¥è¢«å¤åˆ¶ã€ç»§æ‰¿ã€åˆ‡æ¢çš„æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ã€‚</p>
<h3 id="context-æ˜¯æ€ä¹ˆè·Ÿç€åç¨‹è·‘çš„">3.2 Context
æ˜¯æ€ä¹ˆâ€è·Ÿç€åç¨‹è·‘â€çš„ï¼Ÿ</h3>
<h4 id="åç¨‹åˆ›å»ºæ—¶">åç¨‹åˆ›å»ºæ—¶</h4>
<p>å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°ä»»åŠ¡ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asyncio.create_task(coro())</span><br></pre></td></tr></table></figure>
<p>CPython ä¼šåšä¸€ä»¶éå¸¸å…³é”®çš„äº‹æƒ…ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">new_task.context = copy(current_context)</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li>æ–° Task <strong>æ‹·è´çˆ¶ Task çš„ Context</strong></li>
<li>åç»­ä¿®æ”¹äº’ä¸å½±å“</li>
</ul>
<p>ğŸ“Œ è¿™æ˜¯ ContextVar èƒ½åœ¨ async åœºæ™¯ä¸‹æ­£ç¡®éš”ç¦»çš„æ ¹æœ¬åŸå› ã€‚</p>
<h3 id="contextvar.set-åˆ°åº•åšäº†ä»€ä¹ˆ">3.3 ContextVar.set()
åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_llm_context.<span class="built_in">set</span>(ctx)</span><br></pre></td></tr></table></figure>
<p><strong>ä¸æ˜¯</strong>æŠŠå€¼å­˜åˆ° <code>_llm_context</code>
è¿™ä¸ªå¯¹è±¡é‡Œï¼Œè€Œæ˜¯ç­‰ä»·äºï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current_context.data[_llm_context] = ctx</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<ul>
<li><code>ContextVar</code> åªæ˜¯ä¸€ä¸ª key</li>
<li>çœŸæ­£çš„å€¼å­˜åœ¨äº <strong>å½“å‰ Context</strong></li>
</ul>
<h3 id="contextvar.get-æ€ä¹ˆå–å€¼">3.4 ContextVar.get() æ€ä¹ˆå–å€¼ï¼Ÿ</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_llm_context.get()</span><br></pre></td></tr></table></figure>
<p>å†…éƒ¨æµç¨‹ï¼š</p>
<ol type="1">
<li>è·å–å½“å‰æ‰§è¡Œçš„ Context</li>
<li>åœ¨ <code>context.data</code> ä¸­æŸ¥æ‰¾ <code>_llm_context</code></li>
<li>æ‰¾ä¸åˆ°åˆ™è¿”å› default</li>
</ol>
<h3 id="context-åˆ‡æ¢æ˜¯æ€ä¹ˆå‘ç”Ÿçš„">3.5 Context åˆ‡æ¢æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ</h3>
<p>Context åˆ‡æ¢å‘ç”Ÿåœ¨ï¼š</p>
<table>
<thead>
<tr>
<th>åœºæ™¯</th>
<th>æ˜¯å¦åˆ‡æ¢</th>
</tr>
</thead>
<tbody>
<tr>
<td>async/await åˆ‡æ¢</td>
<td>âŒï¼ˆåŒ Task ä¸åˆ‡ï¼‰</td>
</tr>
<tr>
<td>Task åˆ›å»º</td>
<td>âœ…ï¼ˆå¤åˆ¶ï¼‰</td>
</tr>
<tr>
<td>çº¿ç¨‹åˆ‡æ¢</td>
<td>âœ…</td>
</tr>
<tr>
<td><code>contextvars.copy_context()</code></td>
<td>âœ…</td>
</tr>
<tr>
<td><code>Context.run(fn)</code></td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<p>CPython åœ¨ <strong>è°ƒåº¦åç¨‹ / åˆ‡æ¢ Task æ—¶</strong>ï¼Œä¼šåŒæ—¶åˆ‡æ¢å½“å‰
Context æŒ‡é’ˆã€‚</p>
<h2 id="å››ä¸-java-threadlocal-çš„æœ¬è´¨åŒºåˆ«">å››ã€ä¸ Java ThreadLocal
çš„æœ¬è´¨åŒºåˆ«</h2>
<h3 id="æ ¸å¿ƒå·®å¼‚å¯¹æ¯”">4.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>ç»´åº¦</th>
<th>Java ThreadLocal</th>
<th>Python ContextVar</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç»‘å®šå¯¹è±¡</td>
<td><strong>Thread</strong></td>
<td><strong>Execution Contextï¼ˆTaskï¼‰</strong></td>
</tr>
<tr>
<td>async / åç¨‹å®‰å…¨</td>
<td>âŒï¼ˆå¤©ç„¶ä¸å®‰å…¨ï¼‰</td>
<td>âœ…ï¼ˆåŸç”Ÿæ”¯æŒï¼‰</td>
</tr>
<tr>
<td>ä¸Šä¸‹æ–‡å¤åˆ¶</td>
<td>âŒ</td>
<td>âœ…ï¼ˆTask åˆ›å»ºæ—¶æ‹·è´ï¼‰</td>
</tr>
<tr>
<td>ä¸Šä¸‹æ–‡éš”ç¦»ç²’åº¦</td>
<td>ç²—ï¼ˆçº¿ç¨‹ï¼‰</td>
<td>ç»†ï¼ˆåç¨‹ / è°ƒç”¨é“¾ï¼‰</td>
</tr>
<tr>
<td>åµŒå¥—è°ƒç”¨</td>
<td>æ˜“æ±¡æŸ“</td>
<td>å¤©ç„¶æ”¯æŒ</td>
</tr>
<tr>
<td>æ¸…ç†é£é™©</td>
<td>é«˜ï¼ˆå†…å­˜æ³„æ¼ï¼‰</td>
<td>ä½ï¼ˆä½œç”¨åŸŸè‡ªåŠ¨ç»“æŸï¼‰</td>
</tr>
<tr>
<td>æ§åˆ¶ä¼ æ’­</td>
<td>å‡ ä¹ä¸å¯æ§</td>
<td>å¯ç²¾ç¡®æ§åˆ¶</td>
</tr>
</tbody>
</table>
<h3 id="ä¸€å¥è¯æ€»ç»“">4.2 ä¸€å¥è¯æ€»ç»“</h3>
<blockquote>
<p><strong>Java çš„ <code>ThreadLocal</code> = çº¿ç¨‹çº§ä¸Šä¸‹æ–‡ç»‘å®š</strong>
<strong>Python çš„ <code>ContextVar</code> = æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆTask /
åç¨‹è°ƒç”¨é“¾ï¼‰ç»‘å®š</strong></p>
</blockquote>
<p>åœ¨<strong>åŒæ­¥ã€å¤šçº¿ç¨‹æ¨¡å‹</strong>é‡Œå®ƒä»¬â€çœ‹èµ·æ¥åƒâ€ï¼›åœ¨<strong>å¼‚æ­¥ /
åç¨‹æ¨¡å‹</strong>é‡Œï¼Œå®ƒä»¬çš„è¯­ä¹‰æ˜¯<strong>å®Œå…¨ä¸ä¸€æ ·çš„</strong>ã€‚</p>
<h2 id="äº”threadlocal-çš„çœŸå®å·¥ä½œæ–¹å¼">äº”ã€ThreadLocal
çš„çœŸå®å·¥ä½œæ–¹å¼</h2>
<h3 id="threadlocal-å¹¶ä¸å­˜å€¼">5.1 ThreadLocal å¹¶ä¸â€å­˜å€¼â€</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;UserContext&gt; ctx = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p><strong>å€¼å¹¶ä¸åœ¨ <code>ThreadLocal</code> é‡Œ</strong>ï¼Œè€Œæ˜¯åœ¨ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread</span><br><span class="line"> â””â”€ ThreadLocalMap</span><br><span class="line">     â”œâ”€ ThreadLocal A -&gt; valueA</span><br><span class="line">     â””â”€ ThreadLocal B -&gt; valueB</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼š</p>
<blockquote>
<p><strong>ä¸€ä¸ª Thread æŒæœ‰ä¸€å¼  Mapï¼Œkey æ˜¯ ThreadLocal
å®ä¾‹</strong></p>
</blockquote>
<h3 id="threadlocal-çš„è‡´å‘½å‰æ">5.2 ThreadLocal çš„è‡´å‘½å‰æ</h3>
<blockquote>
<p><strong>ä¸€ä¸ªè¯·æ±‚ = ä¸€ä¸ªçº¿ç¨‹</strong></p>
</blockquote>
<p>è¿™åœ¨ï¼š - Servlet æ—©æœŸæ¨¡å‹ - åŒæ­¥é˜»å¡è°ƒç”¨</p>
<p>æ˜¯æˆç«‹çš„ã€‚</p>
<h3 id="åœ¨ç°ä»£-java-é‡Œä¸ºä»€ä¹ˆå‡ºé—®é¢˜">5.3 åœ¨ç°ä»£ Java
é‡Œä¸ºä»€ä¹ˆå‡ºé—®é¢˜ï¼Ÿ</h3>
<h4 id="çº¿ç¨‹æ± å¤ç”¨">â‘  çº¿ç¨‹æ± å¤ç”¨</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread-1</span><br><span class="line"> â”œâ”€ è¯·æ±‚ Aï¼ˆuser=1ï¼‰</span><br><span class="line"> â””â”€ è¯·æ±‚ Bï¼ˆuser=2ï¼‰</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä½ å¿˜äº† <code>remove()</code>ï¼š ğŸ‘‰
<strong>ä¸Šä¸‹æ–‡ä¸²è¯·æ±‚</strong></p>
<h4 id="å¼‚æ­¥æ¨¡å‹completablefuture-reactor">â‘¡ å¼‚æ­¥æ¨¡å‹ï¼ˆCompletableFuture
/ Reactorï¼‰</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CompletableFuture.supplyAsync(...)</span><br></pre></td></tr></table></figure>
<ul>
<li>é€»è¾‘ä¸Šä¸‹æ–‡ â‰  æ‰§è¡Œçº¿ç¨‹</li>
<li>ThreadLocal <strong>ä¸ä¼šè‡ªåŠ¨ä¼ æ’­</strong></li>
<li>ç”šè‡³ä¼ æ’­åˆ°â€é”™è¯¯çš„çº¿ç¨‹â€</li>
</ul>
<p>ğŸ‘‰ å¿…é¡»é ï¼š - æ‰‹åŠ¨ä¼ å‚ - TTLï¼ˆTransmittableThreadLocalï¼‰ - Reactor
Context</p>
<h2 id="å…­é€šä¿—ç†è§£threadlocal-vs-contextvar">å…­ã€é€šä¿—ç†è§£ï¼šThreadLocal
vs ContextVar</h2>
<h3 id="å¤§ç™½è¯åŒºåˆ†">6.1 å¤§ç™½è¯åŒºåˆ†</h3>
<blockquote>
<p><strong>ThreadLocalï¼š</strong>
ğŸ‘‰ã€Œ<strong>è¿™æ¡çº¿ç¨‹åœ¨å¹²æ´»æ—¶ï¼Œç”¨çš„å…±äº«ä¾¿ç­¾çº¸</strong>ã€</p>
</blockquote>
<blockquote>
<p><strong>ContextVarï¼š</strong> ğŸ‘‰ã€Œ<strong>è¿™ä¸€æ¬¡ä»»åŠ¡ / è¯·æ±‚ /
å¯¹è¯ï¼Œè‡ªå¸¦çš„éšèº«å°æœ¬å­</strong>ã€</p>
</blockquote>
<p><strong>ä¾¿ç­¾çº¸è´´åœ¨çº¿ç¨‹ä¸Š</strong>
<strong>å°æœ¬å­è·Ÿç€â€äº‹æƒ…â€èµ°</strong></p>
<h3 id="å…³é”®å·®å¼‚">6.2 å…³é”®å·®å¼‚</h3>
<p><strong>â€œä¸œè¥¿æ˜¯æŒ‚åœ¨çº¿ç¨‹ä¸Šï¼Œè¿˜æ˜¯æŒ‚åœ¨äº‹æƒ…ä¸Šï¼Ÿâ€</strong></p>
<h3 id="ç›´è§‚çš„ç±»æ¯”">6.3 ç›´è§‚çš„ç±»æ¯”</h3>
<h4 id="threadlocal-åƒä»€ä¹ˆ">ThreadLocal åƒä»€ä¹ˆï¼Ÿ</h4>
<blockquote>
<p><strong>åŠå…¬å®¤é‡Œçš„ä¸€å¼ å·¥ä½æ¡Œå­</strong> ä½ æŠŠ user ä¿¡æ¯æ”¾åœ¨æ¡Œä¸Š
è°åè¿™å¼ æ¡Œå­ï¼Œçœ‹åˆ°çš„å°±æ˜¯å®ƒ</p>
</blockquote>
<ul>
<li>äººï¼ˆä»»åŠ¡ï¼‰ä¼šæ¢æ¡Œå­ âŒ</li>
<li>æ¡Œå­ä¼šè¢«å¤ç”¨ âŒ</li>
</ul>
<h4 id="contextvar-åƒä»€ä¹ˆ">ContextVar åƒä»€ä¹ˆï¼Ÿ</h4>
<blockquote>
<p><strong>æ¯ä¸ªäººéšèº«æºå¸¦çš„å·¥ç‰Œ</strong> ä¸ç®¡èµ°åˆ°å“ªã€æ¢å¤šå°‘æˆ¿é—´
å·¥ç‰Œå§‹ç»ˆè·Ÿç€è¿™ä¸ªäºº</p>
</blockquote>
<ul>
<li>äººåˆ†è£‚æˆå¤šä¸ªåˆ†èº« â†’ å¤åˆ¶å·¥ç‰Œ âœ”ï¸</li>
<li>äººç»“æŸ â†’ å·¥ç‰Œä½œåºŸ âœ”ï¸</li>
</ul>
<h2 id="ä¸ƒä¸ºä»€ä¹ˆ-java-é¡¹ç›®ä¹ æƒ¯ç”¨-threadlocal-å­˜-user">ä¸ƒã€ä¸ºä»€ä¹ˆ Java
é¡¹ç›®â€ä¹ æƒ¯ç”¨ ThreadLocal å­˜ userâ€ï¼Ÿ</h2>
<p>ä¸€å¥è¯çœŸç›¸ï¼š</p>
<blockquote>
<p><strong>ä¸æ˜¯ ThreadLocal ç‰¹åˆ«å¼ºï¼Œè€Œæ˜¯ Java
æ—©æœŸæ¨¡å‹å¤ªå•ä¸€</strong></p>
</blockquote>
<ul>
<li>åŒæ­¥</li>
<li>é˜»å¡</li>
<li>ä¸€è¯·æ±‚ä¸€çº¿ç¨‹</li>
</ul>
<p>åœ¨è¿™ä¸ªä¸–ç•Œé‡Œï¼š</p>
<blockquote>
<p>â€œçº¿ç¨‹ â‰ˆ è¯·æ±‚ â‰ˆ ä¸Šä¸‹æ–‡â€</p>
</blockquote>
<p>æ‰€ä»¥ ThreadLocal æ°å¥½â€å‡‘å·§å¥½ç”¨â€ã€‚</p>
<h2 id="å…«ç°ä»£æ¨¡å‹çš„æŒ‘æˆ˜">å…«ã€ç°ä»£æ¨¡å‹çš„æŒ‘æˆ˜</h2>
<p>ä»Šå¤©å¸¸è§çš„æ˜¯ï¼š - å¼‚æ­¥ - å›è°ƒ - æ¶ˆæ¯é©±åŠ¨ - AI Agent / Tool / RAG -
ä¸€ä¸ªè¯·æ±‚æ‹†æˆ N ä¸ªå­ä»»åŠ¡</p>
<p>è¿™æ—¶å€™ï¼š</p>
<blockquote>
<p><strong>â€œçº¿ç¨‹â€å·²ç»ä¸èƒ½ä»£è¡¨â€å½“å‰è¿™ä»¶äº‹â€äº†</strong></p>
</blockquote>
<h3 id="å¯ä»¥è¿™æ ·è·Ÿ-java-åŒäº‹è¯´">8.1 å¯ä»¥è¿™æ ·è·Ÿ Java åŒäº‹è¯´ï¼š</h3>
<blockquote>
<p><strong>ThreadLocal é€‚åˆâ€çº¿ç¨‹å°±æ˜¯è¯·æ±‚â€çš„æ—¶ä»£</strong>
<strong>ContextVar é€‚åˆâ€ä¸€ä¸ªè¯·æ±‚ä¼šåˆ†è£‚æˆå¾ˆå¤šå¹¶å‘ä»»åŠ¡â€çš„æ—¶ä»£</strong></p>
</blockquote>
<h2 id="ä¹åç¨‹çº§åˆ«å­˜å‚¨çš„å®ç°">ä¹ã€åç¨‹çº§åˆ«å­˜å‚¨çš„å®ç°</h2>
<h3 id="èƒ½ä¸èƒ½å®ç°ä¸€ä¸ªåç¨‹çº§åˆ«çš„å­˜å‚¨">9.1
èƒ½ä¸èƒ½å®ç°ä¸€ä¸ªâ€åç¨‹çº§åˆ«çš„å­˜å‚¨â€ï¼Ÿ</h3>
<blockquote>
<p><strong>æ˜¯çš„ï¼Œå®Œå…¨å¯ä»¥å®ç°â€åç¨‹çº§åˆ«çš„å­˜å‚¨â€</strong> è€Œä¸” Python çš„
<code>ContextVar</code>ã€Java Loom çš„ <code>ScopedValue</code>
æœ¬è´¨ä¸Šå°±æ˜¯å®ƒã€‚</p>
</blockquote>
<p>ä½†æœ‰ä¸€ä¸ªå…³é”®å‰æï¼š</p>
<blockquote>
<p><strong>è¿™ä¸ªä¸œè¥¿å¿…é¡»ç”±â€è¯­è¨€è¿è¡Œæ—¶ / è°ƒåº¦å™¨â€é…åˆå®ç°</strong>
<strong>ç”¨æ™®é€šåº“ï¼Œæœ€å¤šåªèƒ½åšåˆ°â€è¿‘ä¼¼æ¨¡æ‹Ÿâ€ï¼Œåšä¸åˆ°è¯­ä¹‰å®Œæ•´</strong></p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆåç¨‹çº§åˆ«å­˜å‚¨ä¸æ˜¯-threadlocal-å‡çº§ç‰ˆ">9.2
ä¸ºä»€ä¹ˆâ€åç¨‹çº§åˆ«å­˜å‚¨â€ä¸æ˜¯ ThreadLocal å‡çº§ç‰ˆï¼Ÿ</h3>
<p>å…ˆç”¨ä¸€å¥é€šä¿—çš„è¯è¯´æ¸…æ¥šæœ¬è´¨åŒºåˆ«ï¼š</p>
<blockquote>
<p><strong>ThreadLocal æ˜¯ï¼šå€¼æŒ‚åœ¨çº¿ç¨‹ä¸Š</strong>
<strong>åç¨‹çº§å­˜å‚¨æ˜¯ï¼šå€¼æŒ‚åœ¨â€å½“å‰æ‰§è¡Œå•å…ƒâ€ä¸Š</strong></p>
</blockquote>
<p>å…³é”®åœ¨äºï¼š ğŸ‘‰ <strong>è°åœ¨æ§åˆ¶â€å½“å‰æ‰§è¡Œå•å…ƒâ€ï¼Ÿ</strong></p>
<ul>
<li>çº¿ç¨‹ â†’ OS / JVM</li>
<li>åç¨‹ â†’ <strong>è¯­è¨€è¿è¡Œæ—¶è°ƒåº¦å™¨</strong></li>
</ul>
<h3 id="çœŸæ­£çš„éš¾ç‚¹">9.3 çœŸæ­£çš„éš¾ç‚¹</h3>
<h4 id="éš¾ç‚¹-1ä½ æ€ä¹ˆæ‹¿åˆ°å½“å‰åç¨‹æ˜¯è°">â— éš¾ç‚¹
1ï¼šä½ æ€ä¹ˆæ‹¿åˆ°â€å½“å‰åç¨‹æ˜¯è°â€ï¼Ÿ</h4>
<ul>
<li>Javaï¼ˆæ—  Loomï¼‰ï¼š
<ul>
<li>âŒ JVM æ ¹æœ¬ä¸çŸ¥é“â€åç¨‹â€è¿™ä¸ªæ¦‚å¿µ</li>
<li>âŒ CompletableFuture / Reactor éƒ½æ˜¯åº“çº§æŠ½è±¡</li>
</ul></li>
<li>Python / Goï¼š
<ul>
<li>âœ… è¿è¡Œæ—¶çŸ¥é“å½“å‰ Task / Goroutine</li>
</ul></li>
</ul>
<p>ğŸ‘‰ <strong>æ²¡æœ‰â€è°ƒåº¦å™¨è§†è§’â€ï¼Œä½ æ ¹æœ¬ä¸çŸ¥é“å½“å‰æ˜¯è°åœ¨è·‘</strong></p>
<h4 id="éš¾ç‚¹-2åç¨‹åˆ‡æ¢æ—¶è°å¸®ä½ åˆ‡ä¸Šä¸‹æ–‡">â— éš¾ç‚¹
2ï¼šåç¨‹åˆ‡æ¢æ—¶ï¼Œè°å¸®ä½ åˆ‡ä¸Šä¸‹æ–‡ï¼Ÿ</h4>
<p>åç¨‹æ‰§è¡Œæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Task A â†’ suspend</span><br><span class="line">Task B â†’ run</span><br><span class="line">Task A â†’ resume</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸‰æ¬¡åˆ‡æ¢ä¸­ï¼Œä½ éœ€è¦ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">åˆ‡èµ° A æ—¶ï¼šä¿å­˜ä¸Šä¸‹æ–‡</span><br><span class="line">åˆ‡åˆ° B æ—¶ï¼šæ¢å¤ B çš„ä¸Šä¸‹æ–‡</span><br></pre></td></tr></table></figure>
<p>âš ï¸ è¿™ä¸ªæ—¶æœºåªæœ‰<strong>è¿è¡Œæ—¶</strong>çŸ¥é“ã€‚</p>
<h4 id="éš¾ç‚¹-3å­åç¨‹çš„ä¸Šä¸‹æ–‡ç»§æ‰¿è¯­ä¹‰">â— éš¾ç‚¹
3ï¼šå­åç¨‹çš„â€ä¸Šä¸‹æ–‡ç»§æ‰¿â€è¯­ä¹‰</h4>
<p>ä½ çœŸæ­£æƒ³è¦çš„æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">çˆ¶åç¨‹</span><br><span class="line"> â””â”€ user = A</span><br><span class="line">     â”œâ”€ å­åç¨‹ 1ï¼ˆç»§æ‰¿ Aï¼‰</span><br><span class="line">     â””â”€ å­åç¨‹ 2ï¼ˆç»§æ‰¿ Aï¼‰</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ­¥æ„å‘³ç€ï¼š</p>
<ul>
<li><strong>åˆ›å»ºåç¨‹æ—¶ï¼Œè¦æ‹·è´ä¸Šä¸‹æ–‡</strong></li>
<li><strong>è€Œä¸æ˜¯å…±äº«åŒä¸€ä»½</strong></li>
</ul>
<p>è¿™å·²ç»æ˜¯<strong>è¯­è¨€è¯­ä¹‰è®¾è®¡é—®é¢˜</strong>äº†ï¼Œè€Œä¸æ˜¯å·¥å…·ç±»é—®é¢˜ã€‚</p>
<h3 id="ç°å®ä¸–ç•Œçš„æ­£ç¡®ç­”æ¡ˆ">9.4 ç°å®ä¸–ç•Œçš„â€æ­£ç¡®ç­”æ¡ˆâ€</h3>
<h4 id="pythoncontextvar">1ï¸âƒ£ Pythonï¼šContextVar</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user = ContextVar(<span class="string">"user"</span>)</span><br><span class="line"></span><br><span class="line">user.<span class="built_in">set</span>(<span class="string">"A"</span>)</span><br><span class="line">asyncio.create_task(task())  <span class="comment"># è‡ªåŠ¨ç»§æ‰¿</span></span><br></pre></td></tr></table></figure>
<p>æœ¬è´¨æ˜¯ï¼š</p>
<blockquote>
<p><strong>åç¨‹åˆ›å»ºæ—¶ï¼Œè¿è¡Œæ—¶å¤åˆ¶ Context</strong></p>
</blockquote>
<h4 id="java-æ–°æ—¶ä»£çš„ç­”æ¡ˆloom-scopedvalue">2ï¸âƒ£ Java æ–°æ—¶ä»£çš„ç­”æ¡ˆï¼šLoom +
ScopedValue</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ScopedValue&lt;User&gt; USER = ScopedValue.newInstance();</span><br><span class="line"></span><br><span class="line">ScopedValue.where(USER, userA).run(() -&gt; {</span><br><span class="line">    <span class="comment">// è¿™é‡Œ USER.get() == userA</span></span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p>å…³é”®ç‚¹ï¼š - ä½œç”¨åŸŸçº§ - è‡ªåŠ¨å›æ»š - <strong>ç»‘å®šçš„æ˜¯â€è™šæ‹Ÿçº¿ç¨‹ /
æ‰§è¡Œä¸Šä¸‹æ–‡â€</strong></p>
<h4 id="goç›´æ¥å†…å»ºåˆ°-runtime">3ï¸âƒ£ Goï¼šç›´æ¥å†…å»ºåˆ° runtime</h4>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context.Context</span><br></pre></td></tr></table></figure>
<ul>
<li>æ˜¾å¼ä¼ </li>
<li>runtime ååŠ©</li>
<li>ä¸ä¾èµ–çº¿ç¨‹</li>
</ul>
<h2 id="åthreadlocal-çš„å†…å­˜æ³„éœ²é£é™©">åã€ThreadLocal
çš„å†…å­˜æ³„éœ²é£é™©</h2>
<h3 id="ä¸€å¥è¯ç»“è®º">10.1 ä¸€å¥è¯ç»“è®º</h3>
<blockquote>
<p><strong>ThreadLocal çš„å†…å­˜æ³„éœ²ï¼Œæœ¬è´¨ä¸æ˜¯â€æ²¡äºº removeâ€ï¼Œ</strong>
<strong>è€Œæ˜¯ï¼š<code>ThreadLocalMap</code> çš„ key ä¼šè¢« GC æ‰ï¼Œä½† value
è¿˜è¢«çº¿ç¨‹å¼ºå¼•ç”¨ç€ã€‚</strong></p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯å¸¸è¯´çš„ï¼š</p>
<blockquote>
<p><strong>â€œkey æ˜¯å¼±å¼•ç”¨ï¼Œvalue æ˜¯å¼ºå¼•ç”¨â€</strong></p>
</blockquote>
<h3 id="threadlocal-çš„çœŸå®å­˜å‚¨ç»“æ„">10.2 ThreadLocal çš„çœŸå®å­˜å‚¨ç»“æ„</h3>
<h4 id="threadlocal-å¹¶ä¸å­˜æ•°æ®">ThreadLocal å¹¶ä¸å­˜æ•°æ®</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;User&gt; userCtx = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>å¾ˆå¤šäººè¯¯ä»¥ä¸º <code>userCtx</code> é‡Œå­˜äº†
<code>User</code>ï¼Œ<strong>è¿™æ˜¯é”™çš„</strong>ã€‚</p>
<p>çœŸå®ç»“æ„æ˜¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Thread</span><br><span class="line"> â””â”€ ThreadLocalMap</span><br><span class="line">      â”œâ”€ Entry(key=ThreadLocal, value=User)</span><br></pre></td></tr></table></figure>
<p>ğŸ“Œ <strong>Thread æŒæœ‰ ThreadLocalMap</strong> ğŸ“Œ
<strong>ThreadLocalMap æŒæœ‰ value çš„å¼ºå¼•ç”¨</strong></p>
<h3 id="æ³„éœ²æ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥å‘ç”Ÿçš„">10.3 æ³„éœ²æ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥å‘ç”Ÿçš„ï¼Ÿ</h3>
<h4 id="ç¬¬-1-æ­¥ä½ åˆ›å»ºäº†-threadlocal">ğŸ§© ç¬¬ 1 æ­¥ï¼šä½ åˆ›å»ºäº†
ThreadLocal</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">handle</span><span class="params">()</span> {</span><br><span class="line">    ThreadLocal&lt;BigObject&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    tl.set(<span class="keyword">new</span> <span class="title class_">BigObject</span>());</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>ç»“æ„ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread</span><br><span class="line"> â””â”€ ThreadLocalMap</span><br><span class="line">      â””â”€ key = tlï¼ˆå¼±å¼•ç”¨ï¼‰</span><br><span class="line">      â””â”€ value = BigObjectï¼ˆå¼ºå¼•ç”¨ï¼‰</span><br></pre></td></tr></table></figure>
<h4 id="ç¬¬-2-æ­¥æ–¹æ³•ç»“æŸthreadlocal-å˜é‡æ¶ˆå¤±">ğŸ§© ç¬¬ 2
æ­¥ï¼šæ–¹æ³•ç»“æŸï¼ŒThreadLocal å˜é‡æ¶ˆå¤±</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tl è¿™ä¸ªå±€éƒ¨å˜é‡</span><br><span class="line">â†“</span><br><span class="line">æ²¡æœ‰ä»»ä½•å¼ºå¼•ç”¨</span><br><span class="line">â†“</span><br><span class="line">GC å›æ”¶ ThreadLocal å¯¹è±¡</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨å˜æˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Thread</span><br><span class="line"> â””â”€ ThreadLocalMap</span><br><span class="line">      â””â”€ key = null   ï¼ˆå¼±å¼•ç”¨è¢«å›æ”¶ï¼‰</span><br><span class="line">      â””â”€ value = BigObjectï¼ˆè¿˜åœ¨ï¼ï¼‰</span><br></pre></td></tr></table></figure>
<p>âš ï¸ <strong>é‡ç‚¹æ¥äº†ï¼švalue è¿˜æ´»ç€</strong></p>
<h4 id="ç¬¬-3-æ­¥çº¿ç¨‹è¿˜æ´»ç€çº¿ç¨‹æ± ">ğŸ§© ç¬¬ 3 æ­¥ï¼šçº¿ç¨‹è¿˜æ´»ç€ï¼ˆçº¿ç¨‹æ± ï¼‰</h4>
<p>åœ¨ Web æœåŠ¡ä¸­ï¼š - çº¿ç¨‹æ¥è‡ªçº¿ç¨‹æ±  - çº¿ç¨‹ <strong>ç”Ÿå‘½å‘¨æœŸ â‰ˆ
åº”ç”¨ç”Ÿå‘½å‘¨æœŸ</strong></p>
<p>æ‰€ä»¥ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocalMap</span><br><span class="line">  â†’ Entry(key=null, value=BigObject)</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ª <code>BigObject</code>ï¼š - âŒ æ— æ³•é€šè¿‡ key è®¿é—® - âŒ æ— æ³•è¢« GC -
âŒ æ— æ³• remove</p>
<p>ğŸ‘‰ <strong>å½»åº•å˜æˆâ€åƒµå°¸å¯¹è±¡â€</strong></p>
<h3 id="ä¸ºä»€ä¹ˆçº¿ç¨‹æ± ä¼šæŠŠé—®é¢˜æ”¾å¤§-100-å€">10.4 ä¸ºä»€ä¹ˆçº¿ç¨‹æ± ä¼šæŠŠé—®é¢˜æ”¾å¤§
100 å€ï¼Ÿ</h3>
<p>å¦‚æœæ˜¯ä¸€æ¬¡æ€§çº¿ç¨‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ç»“æŸ â†’ ThreadLocalMap é‡Šæ”¾ â†’ ä¸€åˆ‡ OK</span><br></pre></td></tr></table></figure>
<p>ä½†åœ¨çº¿ç¨‹æ± ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">çº¿ç¨‹ä¸€ç›´æ´»ç€</span><br><span class="line">â†“</span><br><span class="line">ThreadLocalMap ä¸€ç›´æ´»ç€</span><br><span class="line">â†“</span><br><span class="line">value ä¸€ç›´æ´»ç€</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ï¼š</p>
<blockquote>
<p><strong>ThreadLocal çš„å†…å­˜æ³„éœ²ï¼Œæœ¬è´¨ä¸Šæ˜¯â€çº¿ç¨‹æ´»å¾—å¤ªä¹…â€</strong></p>
</blockquote>
<h3 id="ä¸ºä»€ä¹ˆ-contextvar-scopedvalue-ä¸ä¼šè¿™æ ·">10.5 ä¸ºä»€ä¹ˆ ContextVar /
ScopedValue ä¸ä¼šè¿™æ ·ï¼Ÿ</h3>
<p>å› ä¸ºå®ƒä»¬æ˜¯ï¼š - <strong>ä½œç”¨åŸŸçº§</strong> -
<strong>éšæ‰§è¡Œç»“æŸè‡ªåŠ¨é”€æ¯</strong> -
<strong>ä¸ç»‘å®šâ€é•¿å¯¿å‘½å®¹å™¨â€</strong></p>
<p>å®ƒä»¬æ›´åƒï¼š</p>
<blockquote>
<p><strong>å‡½æ•°æ ˆä¸Šçš„å˜é‡ï¼Œè€Œä¸æ˜¯çº¿ç¨‹ç§æœ‰ç¼“å­˜</strong></p>
</blockquote>
<h2 id="åä¸€å¼‚æ­¥ä»»åŠ¡é“¾çš„æ­£ç¡®ç†è§£">åä¸€ã€å¼‚æ­¥/ä»»åŠ¡é“¾çš„æ­£ç¡®ç†è§£</h2>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ-1">11.1 æ ¸å¿ƒæ¦‚å¿µ</h3>
<blockquote>
<p><strong>è¿™é‡Œè¯´çš„â€å¼‚æ­¥ / ä»»åŠ¡é“¾â€ï¼Œæ—¢ä¸æ˜¯â€å­çº¿ç¨‹â€ï¼Œ</strong>
<strong>ä¹Ÿä¸å®Œå…¨ç­‰åŒäºâ€åç¨‹â€ï¼Œè€Œæ˜¯ï¼š</strong>
ğŸ‘‰ã€Œä¸€ä»¶é€»è¾‘ä¸Šçš„äº‹æƒ…ï¼Œè¢«æ‹†æˆäº†å¤šä¸ªæ‰§è¡Œç‰‡æ®µï¼Œåœ¨ä¸åŒæ—¶é—´ã€å¯èƒ½åœ¨ä¸åŒçº¿ç¨‹ä¸Šç»§ç»­æ‰§è¡Œã€</p>
</blockquote>
<p><strong>é‡ç‚¹æ˜¯ï¼šé€»è¾‘è¿ç»­ â‰  æ‰§è¡Œè¿ç»­</strong></p>
<h3 id="ä¸‰ä¸ªå…³é”®æ¦‚å¿µ">11.2 ä¸‰ä¸ªå…³é”®æ¦‚å¿µ</h3>
<h4 id="çº¿ç¨‹thread">1ï¸âƒ£ çº¿ç¨‹ï¼ˆThreadï¼‰</h4>
<blockquote>
<p><strong>çº¿ç¨‹æ˜¯â€CPU æ‰§è¡Œçš„è½½ä½“â€</strong></p>
</blockquote>
<p>ç‰¹ç‚¹ï¼š - OS / JVM è°ƒåº¦ - æœ‰ç‹¬ç«‹çš„æ ˆ - ç”Ÿå‘½å‘¨æœŸé€šå¸¸è¾ƒé•¿ï¼ˆçº¿ç¨‹æ± ï¼‰</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CPU â†â†’ Thread</span><br></pre></td></tr></table></figure>
<p>ğŸ‘‰ ThreadLocal å°±æ˜¯<strong>ç»‘åœ¨çº¿ç¨‹ä¸Šçš„</strong></p>
<h4 id="åç¨‹coroutine-task-fiber">2ï¸âƒ£ åç¨‹ï¼ˆCoroutine / Task /
Fiberï¼‰</h4>
<blockquote>
<p><strong>åç¨‹æ˜¯â€ä¸€æ®µå¯ä»¥æš‚åœã€æ¢å¤çš„æ‰§è¡Œé€»è¾‘â€</strong></p>
</blockquote>
<p>ç‰¹ç‚¹ï¼š - ä¸ä¸€å®šç»‘å®šçº¿ç¨‹ - å¯ä»¥åœ¨ä¸åŒçº¿ç¨‹ä¸Šæ¢å¤ - ç”Ÿå‘½å‘¨æœŸ =
é€»è¾‘ä»»åŠ¡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Task A</span><br><span class="line"> â”œâ”€ suspend</span><br><span class="line"> â”œâ”€ resume</span><br><span class="line"> â””â”€ finish</span><br></pre></td></tr></table></figure>
<p>ğŸ‘‰ ContextVar / ScopedValue ç»‘å®šçš„æ˜¯è¿™ä¸ªå±‚é¢</p>
<h4 id="å¼‚æ­¥-ä»»åŠ¡é“¾">3ï¸âƒ£ å¼‚æ­¥ / ä»»åŠ¡é“¾</h4>
<blockquote>
<p><strong>å¼‚æ­¥ / ä»»åŠ¡é“¾ =ã€Œä¸€æ¬¡é€»è¾‘ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸã€</strong></p>
</blockquote>
<p>å®ƒå¯èƒ½åŒ…å«ï¼š - åŒæ­¥ä»£ç  - å¼‚æ­¥å›è°ƒ - å¤šä¸ªåç¨‹ - å¤šä¸ªçº¿ç¨‹åˆ‡æ¢</p>
<p><strong>å®ƒæ˜¯â€é€»è¾‘æ¦‚å¿µâ€ï¼Œä¸æ˜¯æ‰§è¡Œå®ä½“</strong></p>
<h3 id="ä¸ºä»€ä¹ˆ-threadlocal-åœ¨è¿™é‡Œå°±ä¸è¡Œäº†">11.3 ä¸ºä»€ä¹ˆ ThreadLocal
åœ¨è¿™é‡Œå°±ä¸è¡Œäº†ï¼Ÿ</h3>
<p>å› ä¸º ThreadLocal çš„ä¸–ç•Œè§‚æ˜¯ï¼š</p>
<blockquote>
<p><strong>â€œå½“å‰çº¿ç¨‹ = å½“å‰äº‹æƒ…â€</strong></p>
</blockquote>
<p>ä½†ç°å®å·²ç»å˜æˆï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å½“å‰äº‹æƒ…</span><br><span class="line"> â”œâ”€ Thread-1ï¼ˆä¸€ä¼šå„¿ï¼‰</span><br><span class="line"> â”œâ”€ Thread-7ï¼ˆä¸€ä¼šå„¿ï¼‰</span><br><span class="line"> â””â”€ Thread-3ï¼ˆä¸€ä¼šå„¿ï¼‰</span><br></pre></td></tr></table></figure>
<p>ä½ æŠŠ user æ”¾åœ¨ ThreadLocalï¼š - çº¿ç¨‹ä¸€æ¢ - ä¸Šä¸‹æ–‡å°±æ–­äº†</p>
<h3 id="contextvar-scopedvalue-æ˜¯æ€ä¹ˆç†è§£ä»»åŠ¡é“¾çš„">11.4 ContextVar /
ScopedValue æ˜¯æ€ä¹ˆç†è§£â€ä»»åŠ¡é“¾â€çš„ï¼Ÿ</h3>
<h4 id="æ ¸å¿ƒä¸€å¥è¯">æ ¸å¿ƒä¸€å¥è¯ï¼š</h4>
<blockquote>
<p><strong>å®ƒä»¬ä¸å…³å¿ƒâ€ä½ åœ¨å“ªä¸ªçº¿ç¨‹â€ï¼Œ</strong>
<strong>åªå…³å¿ƒâ€ä½ æ˜¯ä¸æ˜¯åœ¨åŒä¸€æ¡æ‰§è¡Œè¯­ä¹‰é“¾ä¸Šâ€</strong></p>
</blockquote>
<h4 id="pythoncontextvar-1">Pythonï¼ˆContextVarï¼‰</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user.<span class="built_in">set</span>(<span class="string">"A"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">await</span> step1()</span><br><span class="line"><span class="keyword">await</span> step2()</span><br></pre></td></tr></table></figure>
<ul>
<li><code>await</code> ä¼šæŒ‚èµ·</li>
<li>ä»»åŠ¡æ¢å¤æ—¶ï¼ŒContext è‡ªåŠ¨å¸¦å›æ¥</li>
<li><strong>å“ªæ€•æ¢çº¿ç¨‹ï¼Œè¯­ä¹‰ä¸å˜</strong></li>
</ul>
<h4 id="java-loomscopedvalue">Java Loomï¼ˆScopedValueï¼‰</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ScopedValue.where(USER, userA).run(() -&gt; {</span><br><span class="line">    step1();</span><br><span class="line">    step2();</span><br><span class="line">});</span><br></pre></td></tr></table></figure>
<p><code>run</code> å®šä¹‰äº†ä¸€ä¸ª<strong>ä½œç”¨åŸŸ</strong>ï¼š - åœ¨è¿™ä¸ªä½œç”¨åŸŸå†…
- ä¸ç®¡æ€ä¹ˆåˆ‡æ¢æ‰§è¡Œå•å…ƒ - USER éƒ½æ˜¯åŒä¸€ä¸ª</p>
<h3 id="éå¸¸å…³é”®çš„ä¸€ç‚¹">11.5 éå¸¸å…³é”®çš„ä¸€ç‚¹</h3>
<p><strong>â€œå¼‚æ­¥ / ä»»åŠ¡é“¾ â‰  å­çº¿ç¨‹â€</strong></p>
<p>æˆ‘ä»¬ç›´æ¥å¯¹æ¯”ï¼š</p>
<table>
<thead>
<tr>
<th>æ¦‚å¿µ</th>
<th>æ˜¯ä¸æ˜¯å­çº¿ç¨‹ï¼Ÿ</th>
</tr>
</thead>
<tbody>
<tr>
<td>Thread</td>
<td>âœ… æ˜¯</td>
</tr>
<tr>
<td>åç¨‹ / Task</td>
<td>âŒ ä¸æ˜¯</td>
</tr>
<tr>
<td>å¼‚æ­¥ä»»åŠ¡é“¾</td>
<td>âŒ ä¸æ˜¯</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>å¼‚æ­¥ä»»åŠ¡é“¾æ˜¯ä¸€ç§â€é€»è¾‘è¿ç»­æ€§â€ï¼Œä¸æ˜¯æ‰§è¡Œæ–¹å¼</strong></p>
</blockquote>
<h2 id="åäºŒå®æˆ˜åº”ç”¨llm-è°ƒç”¨é“¾è¿½è¸ª">åäºŒã€å®æˆ˜åº”ç”¨ï¼šLLM è°ƒç”¨é“¾è¿½è¸ª</h2>
<h3 id="æ ‡å‡†å®ç°æ¨¡å¼">12.1 æ ‡å‡†å®ç°æ¨¡å¼</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> contextvars <span class="keyword">import</span> ContextVar</span><br><span class="line"></span><br><span class="line">_llm_context: ContextVar[<span class="type">Optional</span>[LLMCallContext]] = ContextVar(</span><br><span class="line">    <span class="string">"llm_context"</span>, default=<span class="literal">None</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">llm_context</span>(<span class="params">module_name: <span class="built_in">str</span>, user_id: <span class="built_in">str</span> = <span class="literal">None</span>, conversation_id: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">    ctx = LLMCallContext(</span><br><span class="line">        request_id=<span class="built_in">str</span>(uuid.uuid4()),</span><br><span class="line">        module_name=module_name,</span><br><span class="line">        user_id=user_id,</span><br><span class="line">        conversation_id=conversation_id,</span><br><span class="line">    )</span><br><span class="line">    _llm_context.<span class="built_in">set</span>(ctx)  <span class="comment"># è®¾ç½®åˆ°ä¸Šä¸‹æ–‡å˜é‡</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> ctx</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        clear_llm_context()  <span class="comment"># è‡ªåŠ¨æ¸…é™¤</span></span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨ç¤ºä¾‹">12.2 ä½¿ç”¨ç¤ºä¾‹</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åœ¨ä»»æ„å‡½æ•°ä¸­è·å–ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_llm_context</span>():</span><br><span class="line">    <span class="keyword">return</span> _llm_context.get()</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨ Agent / Tool è°ƒç”¨ä¸­è‡ªç„¶ä¼ æ’­</span></span><br><span class="line"><span class="meta">@contextmanager</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">llm_context</span>(<span class="params">module_name: <span class="built_in">str</span>, user_id: <span class="built_in">str</span> = <span class="literal">None</span>, conversation_id: <span class="built_in">str</span> = <span class="literal">None</span></span>):</span><br><span class="line">    ctx = LLMCallContext(...)</span><br><span class="line">    _llm_context.<span class="built_in">set</span>(ctx)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">yield</span> ctx</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        _llm_context.<span class="built_in">set</span>(<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<h3 id="ä¼˜åŠ¿ä½“ç°">12.3 ä¼˜åŠ¿ä½“ç°</h3>
<ul>
<li><strong>è·¨åç¨‹ä¼ æ’­</strong>ï¼šåœ¨ async/await ä¸­è‡ªåŠ¨ä¼ æ’­</li>
<li><strong>ä»»åŠ¡éš”ç¦»</strong>ï¼šä¸åŒè¯·æ±‚/ç”¨æˆ·ä¸Šä¸‹æ–‡äº’ä¸å¹²æ‰°</li>
<li><strong>ä½œç”¨åŸŸç®¡ç†</strong>ï¼šä½¿ç”¨ contextmanager è‡ªåŠ¨æ¸…ç†</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šé€šè¿‡ç±»å‹æ³¨è§£ä¿è¯ç±»å‹æ­£ç¡®</li>
</ul>
<h2 id="åä¸‰æ€»ç»“ä¸é€‰å‹å»ºè®®">åä¸‰ã€æ€»ç»“ä¸é€‰å‹å»ºè®®</h2>
<h3 id="æ ¸å¿ƒè¦ç‚¹å›é¡¾">13.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol type="1">
<li><strong>ContextVar ç»‘å®šçš„æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡</strong>ï¼Œè€Œä¸æ˜¯çº¿ç¨‹</li>
<li><strong>åç¨‹åˆ›å»ºæ—¶è‡ªåŠ¨å¤åˆ¶ Context</strong>ï¼Œä¿è¯ä¸Šä¸‹æ–‡éš”ç¦»</li>
<li><strong>ThreadLocal é€‚åˆåŒæ­¥æ¨¡å‹</strong>ï¼Œä¸é€‚åˆå¼‚æ­¥/åç¨‹</li>
<li><strong>ContextVar ç”Ÿå‘½å‘¨æœŸ = é€»è¾‘ä½œç”¨åŸŸ</strong>ï¼Œä¸ä¼šå†…å­˜æ³„æ¼</li>
<li><strong>å¼‚æ­¥ä»»åŠ¡é“¾æ˜¯é€»è¾‘è¿ç»­çš„</strong>ï¼Œä¸æ˜¯æ‰§è¡Œè¿ç»­</li>
</ol>
<h3 id="é€‰å‹å»ºè®®">13.2 é€‰å‹å»ºè®®</h3>
<h4 id="é€‰æ‹©-contextvarpython">é€‰æ‹© ContextVarï¼ˆPythonï¼‰</h4>
<ul>
<li>âœ… å¼‚æ­¥ç¼–ç¨‹ç¯å¢ƒï¼ˆasyncioã€FastAPIï¼‰</li>
<li>âœ… åç¨‹/ä»»åŠ¡é“¾ä¸Šä¸‹æ–‡ä¼ é€’</li>
<li>âœ… LLM / Agent / RAG è°ƒç”¨é“¾è¿½è¸ª</li>
<li>âœ… éœ€è¦ç»†ç²’åº¦ä¸Šä¸‹æ–‡éš”ç¦»</li>
</ul>
<h4 id="é€‰æ‹©-threadlocaljava">é€‰æ‹© ThreadLocalï¼ˆJavaï¼‰</h4>
<ul>
<li>âœ… çº¯åŒæ­¥è°ƒç”¨æ ˆ</li>
<li>âœ… çº¿ç¨‹ä¸åˆ‡æ¢</li>
<li>âœ… ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ä¸¥æ ¼ç»‘å®š</li>
</ul>
<p>å…¸å‹ä¾‹å­ï¼š - JDBC Connection ç»‘å®šçº¿ç¨‹ - äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼ˆæ—©æœŸ Springï¼‰ -
çº¿ç¨‹å†…ç¼“å­˜</p>
<h4 id="é¿å…ä½¿ç”¨-threadlocaljava">é¿å…ä½¿ç”¨ ThreadLocalï¼ˆJavaï¼‰</h4>
<ul>
<li>âŒ ç”¨æˆ·èº«ä»½ï¼ˆuser / tenantï¼‰</li>
<li>âŒ trace / span</li>
<li>âŒ è¯·æ±‚ä¸Šä¸‹æ–‡</li>
<li>âŒ å¼‚æ­¥å›è°ƒ</li>
<li>âŒ å¹¶å‘ fan-out</li>
</ul>
<h3 id="æœ€ç»ˆåˆ¤æ–­æ ‡å‡†">13.3 æœ€ç»ˆåˆ¤æ–­æ ‡å‡†</h3>
<p>ä½ å¯ä»¥åœ¨ä»£ç è¯„å®¡æ—¶é—®ä¸€å¥ï¼š</p>
<blockquote>
<p><strong>â€œè¿™æ®µä»£ç æœ‰æ²¡æœ‰å¯èƒ½æ¢çº¿ç¨‹æ‰§è¡Œï¼Ÿâ€</strong></p>
</blockquote>
<ul>
<li>å¦‚æœç­”æ¡ˆæ˜¯ <strong>æ°¸è¿œä¸ä¼š</strong> â†’ ThreadLocal å‹‰å¼ºå¯ç”¨</li>
<li>åªè¦æœ‰ <strong>ä¸€ç‚¹å¯èƒ½</strong> â†’ ThreadLocal å°±å·²ç»ä¸å®‰å…¨äº†</li>
</ul>
<h3 id="ä¸€å¥è¯æ—¶ä»£æ€»ç»“">13.4 ä¸€å¥è¯æ—¶ä»£æ€»ç»“</h3>
<blockquote>
<p><strong>ThreadLocal ä¸æ˜¯è¢«â€åºŸå¼ƒâ€äº†ï¼Œ</strong>
<strong>è€Œæ˜¯å®ƒæ‰€ä¾èµ–çš„â€çº¿ç¨‹ = è¯·æ±‚â€çš„æ—¶ä»£ç»“æŸäº†ã€‚</strong></p>
</blockquote>
<p>ä½ ç°åœ¨åšçš„ <strong>LLM / Agent / async ç³»ç»Ÿ</strong>ï¼Œå¦‚æœè¿˜ç”¨
ThreadLocal å­˜ userï¼Œé‚£åŸºæœ¬ç­‰äºï¼š</p>
<blockquote>
<p><strong>åœ¨åç¨‹ä¸–ç•Œé‡Œï¼Œç”¨â€å·¥ä½å·â€æ¥è¯†åˆ«â€äººâ€</strong></p>
</blockquote>
<hr>
<p><em>æœ¬æ–‡æ•´ç†è‡ªä¸ AI çš„æŠ€æœ¯å¯¹è¯ï¼Œæ·±å…¥æ¢è®¨äº† ContextVar
çš„åº•å±‚å®ç°æœºåˆ¶åŠå…¶åœ¨ç°ä»£å¼‚æ­¥ç¼–ç¨‹ä¸­çš„åº”ç”¨ã€‚å¦‚æœ‰ç–‘é—®æˆ–éœ€è¦è¡¥å……ï¼Œæ¬¢è¿è®¨è®ºã€‚</em></p>

                    
                </div>

                
                        
<div class="post-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="copyright-post-title border-box text-ellipsis">
                ContextVaråº•å±‚å®ç°æ·±åº¦è§£æï¼šä»åŸç†åˆ°å®æˆ˜
            </div>

            <div class="copyright-post-link border-box text-ellipsis">
                2026/01/02/contextvar-deep-dive/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="copyright-post-author bottom-item">
                <div class="type">
                    Author
                </div>
                <div class="content">Zhongjun Qiu</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    Published
                </div>
                <div class="content">2026-01-02 00:00</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    License
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed" target="_blank">
                        
                            <i class="fa-brands fa-creative-commons"></i>
                            <i class="fa-brands fa-creative-commons-by"></i>
                            <i class="fa-brands fa-creative-commons-nc"></i>
                            <i class="fa-brands fa-creative-commons-sa"></i>
                        
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="Copy copyright info" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">å¼‚æ­¥ç¼–ç¨‹</a>
                                    </li>
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/ContextVar/">ContextVar</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="Share to QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="Share to WeChat"
            data-tooltip-img-tip="Scan by WeChat"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="Share to WeiBo"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                
                    

<div class="reward-author-container border-box flex-center">
    <div class="reward-btn border-box flex-center tooltip tooltip-img"
            data-tooltip-img-url="/images/post/payment.jpg"
            data-tooltip-img-trigger="click"
            data-tooltip-img-style="top: -6px;"
    >
        <i class="fa-solid fa-gift"></i>&nbsp;REWARD AUTHOR
    </div>
</div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2026/01/06/MCP-Function-Calling-AI-Agent-%E5%85%B3%E7%B3%BB%E8%BE%A8%E6%9E%90/"
                                   title="MCPã€Function Calling ä¸ AI Agentï¼šæ¦‚å¿µè¾¨æä¸å…³ç³»æ¢³ç†"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">MCPã€Function Calling ä¸ AI Agentï¼šæ¦‚å¿µè¾¨æä¸å…³ç³»æ¢³ç†</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2026/01/01/%E9%93%BE%E8%A1%A8-vs-%E6%95%B0%E7%BB%84-%E9%AB%98%E6%80%A7%E8%83%BD%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%80%89%E6%8B%A9/"
                                   title="é“¾è¡¨ vs æ•°ç»„ï¼šä¸ºä»€ä¹ˆé«˜æ€§èƒ½ç³»ç»Ÿåçˆ±è¿ç»­å†…å­˜ï¼Ÿ"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">é“¾è¡¨ vs æ•°ç»„ï¼šä¸ºä»€ä¹ˆé«˜æ€§èƒ½ç³»ç»Ÿåçˆ±è¿ç»­å†…å­˜ï¼Ÿ</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    


    <div class="comments-container border-box">
        <div id="comments-anchor" class="comment-area-title border-box">
            <i class="fas fa-comments"></i>&nbsp;Comments
        </div>
        <div class="comment-plugin-fail border-box">
    <span class="fail-tip">Comment plugin failed to load</span>
    <button class="reload keep-button">Click to reload</button>
</div>
<div class="comment-plugin-loading flex-center border-box">
    <i class="loading-icon fa-solid fa-spinner fa-spin"></i>
    <span class="load-tip">Loading comment plugin</span>
</div>
<script data-pjax>
  window.KeepCommentPlugin = {}
  window.KeepCommentPlugin.hideLoading = () => {
    const cplDom = document.querySelector('.comments-container .comment-plugin-loading')
    cplDom.style.display = 'none'
  }
  window.KeepCommentPlugin.loadFailHandle = () => {
    window.KeepCommentPlugin.hideLoading()
    const cpfDom = document.querySelector('.comments-container .comment-plugin-fail')
    cpfDom.style.display = 'flex'
    cpfDom.querySelector('.reload').addEventListener('click', () => {
      window.location.reload()
    })
  }
</script>

        
            

    <div class="waline-comment-container">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/waline/3.3.2/waline.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/waline/3.3.2/waline-meta.css"/>
        <div id="waline-comment"></div>
        <script data-pjax>
          window.KeepCommentPlugin.walineOptions = JSON.parse('{}'.replace(/&#34;/g, '"'))
          window.KeepCommentPlugin.walineOptions.el = '#waline-comment'
          window.KeepCommentPlugin.walineOptions.comment = '.post-comments-count'
          window.KeepCommentPlugin.walineOptions.serverURL = 'https://waline-vercel-two-rho.vercel.app/'
          window.KeepCommentPlugin.walineOptions.lang = 'en' || 'zh-CN'
          window.KeepCommentPlugin.walineOptions.reaction = 'true' === 'true'
        </script>

        

        
            <script 
                    async
                    type="module"
            >
              import { init } from 'https://cdnjs.cloudflare.com/ajax/libs/waline/3.3.2/waline.js'
              window.KeepCommentPlugin.initWaline = () => {
                if (init) {
                  init(window.KeepCommentPlugin.walineOptions)
                  window.KeepCommentPlugin.hideLoading()
                } else {
                  setTimeout(() => {
                    window.KeepCommentPlugin.initWaline()
                  }, 1000)
                }
              }

              if ('false' === 'true') {
                setTimeout(() => {
                  window.KeepCommentPlugin.initWaline()
                }, 1200)
              } else {
                window.addEventListener('DOMContentLoaded', window.KeepCommentPlugin.initWaline)
              }
            </script>
        
    </div>


        
    </div>





                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%B4%9E%E5%AF%9F"><span class="nav-text">æ ¸å¿ƒæ´å¯Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-contextvar"><span class="nav-text">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ ContextVarï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%A0%E7%BB%9F%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">1.1 ä¼ ç»Ÿæ¨¡å‹çš„é—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar-%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87"><span class="nav-text">1.2 ContextVar çš„è®¾è®¡ç›®æ ‡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8Ccontextvar-%E7%9A%84%E6%8A%BD%E8%B1%A1%E6%A8%A1%E5%9E%8B"><span class="nav-text">äºŒã€ContextVar çš„æŠ½è±¡æ¨¡å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">2.1 æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%BB%93%E6%9E%84"><span class="nav-text">2.2 æŠ½è±¡ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89contextvar-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="nav-text">ä¸‰ã€ContextVar çš„åº•å±‚å®ç°æœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#context-%E6%9C%AC%E8%B4%A8%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">3.1 Context æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#context-%E6%98%AF%E6%80%8E%E4%B9%88%E8%B7%9F%E7%9D%80%E5%8D%8F%E7%A8%8B%E8%B7%91%E7%9A%84"><span class="nav-text">3.2 Context
æ˜¯æ€ä¹ˆâ€è·Ÿç€åç¨‹è·‘â€çš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E5%88%9B%E5%BB%BA%E6%97%B6"><span class="nav-text">åç¨‹åˆ›å»ºæ—¶</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar.set-%E5%88%B0%E5%BA%95%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88"><span class="nav-text">3.3 ContextVar.set()
åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar.get-%E6%80%8E%E4%B9%88%E5%8F%96%E5%80%BC"><span class="nav-text">3.4 ContextVar.get() æ€ä¹ˆå–å€¼ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#context-%E5%88%87%E6%8D%A2%E6%98%AF%E6%80%8E%E4%B9%88%E5%8F%91%E7%94%9F%E7%9A%84"><span class="nav-text">3.5 Context åˆ‡æ¢æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E4%B8%8E-java-threadlocal-%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB"><span class="nav-text">å››ã€ä¸ Java ThreadLocal
çš„æœ¬è´¨åŒºåˆ«</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82%E5%AF%B9%E6%AF%94"><span class="nav-text">4.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%80%BB%E7%BB%93"><span class="nav-text">4.2 ä¸€å¥è¯æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94threadlocal-%E7%9A%84%E7%9C%9F%E5%AE%9E%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="nav-text">äº”ã€ThreadLocal
çš„çœŸå®å·¥ä½œæ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#threadlocal-%E5%B9%B6%E4%B8%8D%E5%AD%98%E5%80%BC"><span class="nav-text">5.1 ThreadLocal å¹¶ä¸â€å­˜å€¼â€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#threadlocal-%E7%9A%84%E8%87%B4%E5%91%BD%E5%89%8D%E6%8F%90"><span class="nav-text">5.2 ThreadLocal çš„è‡´å‘½å‰æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%8E%B0%E4%BB%A3-java-%E9%87%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E9%97%AE%E9%A2%98"><span class="nav-text">5.3 åœ¨ç°ä»£ Java
é‡Œä¸ºä»€ä¹ˆå‡ºé—®é¢˜ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A4%8D%E7%94%A8"><span class="nav-text">â‘  çº¿ç¨‹æ± å¤ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8Bcompletablefuture-reactor"><span class="nav-text">â‘¡ å¼‚æ­¥æ¨¡å‹ï¼ˆCompletableFuture
&#x2F; Reactorï¼‰</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E9%80%9A%E4%BF%97%E7%90%86%E8%A7%A3threadlocal-vs-contextvar"><span class="nav-text">å…­ã€é€šä¿—ç†è§£ï¼šThreadLocal
vs ContextVar</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7%E7%99%BD%E8%AF%9D%E5%8C%BA%E5%88%86"><span class="nav-text">6.1 å¤§ç™½è¯åŒºåˆ†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%B7%AE%E5%BC%82"><span class="nav-text">6.2 å…³é”®å·®å¼‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E8%A7%82%E7%9A%84%E7%B1%BB%E6%AF%94"><span class="nav-text">6.3 ç›´è§‚çš„ç±»æ¯”</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#threadlocal-%E5%83%8F%E4%BB%80%E4%B9%88"><span class="nav-text">ThreadLocal åƒä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contextvar-%E5%83%8F%E4%BB%80%E4%B9%88"><span class="nav-text">ContextVar åƒä»€ä¹ˆï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E4%B8%BA%E4%BB%80%E4%B9%88-java-%E9%A1%B9%E7%9B%AE%E4%B9%A0%E6%83%AF%E7%94%A8-threadlocal-%E5%AD%98-user"><span class="nav-text">ä¸ƒã€ä¸ºä»€ä¹ˆ Java
é¡¹ç›®â€ä¹ æƒ¯ç”¨ ThreadLocal å­˜ userâ€ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E7%8E%B0%E4%BB%A3%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%8C%91%E6%88%98"><span class="nav-text">å…«ã€ç°ä»£æ¨¡å‹çš„æŒ‘æˆ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E8%B7%9F-java-%E5%90%8C%E4%BA%8B%E8%AF%B4"><span class="nav-text">8.1 å¯ä»¥è¿™æ ·è·Ÿ Java åŒäº‹è¯´ï¼š</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E5%8D%8F%E7%A8%8B%E7%BA%A7%E5%88%AB%E5%AD%98%E5%82%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">ä¹ã€åç¨‹çº§åˆ«å­˜å‚¨çš„å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E4%B8%8D%E8%83%BD%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%8D%8F%E7%A8%8B%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AD%98%E5%82%A8"><span class="nav-text">9.1
èƒ½ä¸èƒ½å®ç°ä¸€ä¸ªâ€åç¨‹çº§åˆ«çš„å­˜å‚¨â€ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%8F%E7%A8%8B%E7%BA%A7%E5%88%AB%E5%AD%98%E5%82%A8%E4%B8%8D%E6%98%AF-threadlocal-%E5%8D%87%E7%BA%A7%E7%89%88"><span class="nav-text">9.2
ä¸ºä»€ä¹ˆâ€åç¨‹çº§åˆ«å­˜å‚¨â€ä¸æ˜¯ ThreadLocal å‡çº§ç‰ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%9F%E6%AD%A3%E7%9A%84%E9%9A%BE%E7%82%B9"><span class="nav-text">9.3 çœŸæ­£çš„éš¾ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9-1%E4%BD%A0%E6%80%8E%E4%B9%88%E6%8B%BF%E5%88%B0%E5%BD%93%E5%89%8D%E5%8D%8F%E7%A8%8B%E6%98%AF%E8%B0%81"><span class="nav-text">â— éš¾ç‚¹
1ï¼šä½ æ€ä¹ˆæ‹¿åˆ°â€å½“å‰åç¨‹æ˜¯è°â€ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9-2%E5%8D%8F%E7%A8%8B%E5%88%87%E6%8D%A2%E6%97%B6%E8%B0%81%E5%B8%AE%E4%BD%A0%E5%88%87%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-text">â— éš¾ç‚¹
2ï¼šåç¨‹åˆ‡æ¢æ—¶ï¼Œè°å¸®ä½ åˆ‡ä¸Šä¸‹æ–‡ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9-3%E5%AD%90%E5%8D%8F%E7%A8%8B%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E7%BB%A7%E6%89%BF%E8%AF%AD%E4%B9%89"><span class="nav-text">â— éš¾ç‚¹
3ï¼šå­åç¨‹çš„â€ä¸Šä¸‹æ–‡ç»§æ‰¿â€è¯­ä¹‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%AD%94%E6%A1%88"><span class="nav-text">9.4 ç°å®ä¸–ç•Œçš„â€æ­£ç¡®ç­”æ¡ˆâ€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pythoncontextvar"><span class="nav-text">1ï¸âƒ£ Pythonï¼šContextVar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E6%96%B0%E6%97%B6%E4%BB%A3%E7%9A%84%E7%AD%94%E6%A1%88loom-scopedvalue"><span class="nav-text">2ï¸âƒ£ Java æ–°æ—¶ä»£çš„ç­”æ¡ˆï¼šLoom +
ScopedValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#go%E7%9B%B4%E6%8E%A5%E5%86%85%E5%BB%BA%E5%88%B0-runtime"><span class="nav-text">3ï¸âƒ£ Goï¼šç›´æ¥å†…å»ºåˆ° runtime</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81threadlocal-%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9"><span class="nav-text">åã€ThreadLocal
çš„å†…å­˜æ³„éœ²é£é™©</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E7%BB%93%E8%AE%BA"><span class="nav-text">10.1 ä¸€å¥è¯ç»“è®º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#threadlocal-%E7%9A%84%E7%9C%9F%E5%AE%9E%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="nav-text">10.2 ThreadLocal çš„çœŸå®å­˜å‚¨ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#threadlocal-%E5%B9%B6%E4%B8%8D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="nav-text">ThreadLocal å¹¶ä¸å­˜æ•°æ®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E6%98%AF%E6%80%8E%E4%B9%88%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E5%8F%91%E7%94%9F%E7%9A%84"><span class="nav-text">10.3 æ³„éœ²æ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥å‘ç”Ÿçš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC-1-%E6%AD%A5%E4%BD%A0%E5%88%9B%E5%BB%BA%E4%BA%86-threadlocal"><span class="nav-text">ğŸ§© ç¬¬ 1 æ­¥ï¼šä½ åˆ›å»ºäº†
ThreadLocal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC-2-%E6%AD%A5%E6%96%B9%E6%B3%95%E7%BB%93%E6%9D%9Fthreadlocal-%E5%8F%98%E9%87%8F%E6%B6%88%E5%A4%B1"><span class="nav-text">ğŸ§© ç¬¬ 2
æ­¥ï¼šæ–¹æ³•ç»“æŸï¼ŒThreadLocal å˜é‡æ¶ˆå¤±</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC-3-%E6%AD%A5%E7%BA%BF%E7%A8%8B%E8%BF%98%E6%B4%BB%E7%9D%80%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-text">ğŸ§© ç¬¬ 3 æ­¥ï¼šçº¿ç¨‹è¿˜æ´»ç€ï¼ˆçº¿ç¨‹æ± ï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BC%9A%E6%8A%8A%E9%97%AE%E9%A2%98%E6%94%BE%E5%A4%A7-100-%E5%80%8D"><span class="nav-text">10.4 ä¸ºä»€ä¹ˆçº¿ç¨‹æ± ä¼šæŠŠé—®é¢˜æ”¾å¤§
100 å€ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-contextvar-scopedvalue-%E4%B8%8D%E4%BC%9A%E8%BF%99%E6%A0%B7"><span class="nav-text">10.5 ä¸ºä»€ä¹ˆ ContextVar &#x2F;
ScopedValue ä¸ä¼šè¿™æ ·ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%93%BE%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%90%86%E8%A7%A3"><span class="nav-text">åä¸€ã€å¼‚æ­¥&#x2F;ä»»åŠ¡é“¾çš„æ­£ç¡®ç†è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-1"><span class="nav-text">11.1 æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E4%B8%AA%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5"><span class="nav-text">11.2 ä¸‰ä¸ªå…³é”®æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8Bthread"><span class="nav-text">1ï¸âƒ£ çº¿ç¨‹ï¼ˆThreadï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8Bcoroutine-task-fiber"><span class="nav-text">2ï¸âƒ£ åç¨‹ï¼ˆCoroutine &#x2F; Task &#x2F;
Fiberï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5-%E4%BB%BB%E5%8A%A1%E9%93%BE"><span class="nav-text">3ï¸âƒ£ å¼‚æ­¥ &#x2F; ä»»åŠ¡é“¾</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-threadlocal-%E5%9C%A8%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E8%A1%8C%E4%BA%86"><span class="nav-text">11.3 ä¸ºä»€ä¹ˆ ThreadLocal
åœ¨è¿™é‡Œå°±ä¸è¡Œäº†ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar-scopedvalue-%E6%98%AF%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3%E4%BB%BB%E5%8A%A1%E9%93%BE%E7%9A%84"><span class="nav-text">11.4 ContextVar &#x2F;
ScopedValue æ˜¯æ€ä¹ˆç†è§£â€ä»»åŠ¡é“¾â€çš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="nav-text">æ ¸å¿ƒä¸€å¥è¯ï¼š</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pythoncontextvar-1"><span class="nav-text">Pythonï¼ˆContextVarï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-loomscopedvalue"><span class="nav-text">Java Loomï¼ˆScopedValueï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E5%B8%B8%E5%85%B3%E9%94%AE%E7%9A%84%E4%B8%80%E7%82%B9"><span class="nav-text">11.5 éå¸¸å…³é”®çš„ä¸€ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8llm-%E8%B0%83%E7%94%A8%E9%93%BE%E8%BF%BD%E8%B8%AA"><span class="nav-text">åäºŒã€å®æˆ˜åº”ç”¨ï¼šLLM è°ƒç”¨é“¾è¿½è¸ª</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E5%87%86%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%BC%8F"><span class="nav-text">12.1 æ ‡å‡†å®ç°æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-text">12.2 ä½¿ç”¨ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF%E4%BD%93%E7%8E%B0"><span class="nav-text">12.3 ä¼˜åŠ¿ä½“ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%89%E6%80%BB%E7%BB%93%E4%B8%8E%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE"><span class="nav-text">åä¸‰ã€æ€»ç»“ä¸é€‰å‹å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9%E5%9B%9E%E9%A1%BE"><span class="nav-text">13.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE"><span class="nav-text">13.2 é€‰å‹å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9-contextvarpython"><span class="nav-text">é€‰æ‹© ContextVarï¼ˆPythonï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9-threadlocaljava"><span class="nav-text">é€‰æ‹© ThreadLocalï¼ˆJavaï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-threadlocaljava"><span class="nav-text">é¿å…ä½¿ç”¨ ThreadLocalï¼ˆJavaï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E5%88%A4%E6%96%AD%E6%A0%87%E5%87%86"><span class="nav-text">13.3 æœ€ç»ˆåˆ¤æ–­æ ‡å‡†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%97%B6%E4%BB%A3%E6%80%BB%E7%BB%93"><span class="nav-text">13.4 ä¸€å¥è¯æ—¶ä»£æ€»ç»“</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="copyright-info info-item">
    &copy;&nbsp;<span>2020</span>&nbsp;-&nbsp;2026
    
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">Zhongjun Qiu</a>
        
    </div>

    <div class="theme-info info-item">
        Powered by&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;&&nbsp;Theme&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
    </div>

    
        
        <div class="deploy-info info-item">
            
                <a target="_blank" rel="nofollow" href="https://github.com">
            
            This site is deployed on <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/brands/github.png"></span>
            
                </a>
            
        </div>
    

    
        <div class="count-info info-item">
            
                <span class="count-item border-box word">
                    <span class="item-type border-box">Total words</span>
                    <span class="item-value border-box word">484.9k</span>
                </span>
            

            

            
                <span class="count-item border-box pv">
                    <span class="item-type border-box">Page View</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    

    
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="post-tools-list border-box">
        <!-- PC encrypt again -->
        

        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <!-- toggle mode -->
        
            <li class="tools-item tool-toggle-theme-mode flex-center">
                <i class="fas fa-moon"></i>
            </li>
        

        <!-- rss -->
        

        <!-- to bottom -->
        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%B4%9E%E5%AF%9F"><span class="nav-text">æ ¸å¿ƒæ´å¯Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-contextvar"><span class="nav-text">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦ ContextVarï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%A0%E7%BB%9F%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%97%AE%E9%A2%98"><span class="nav-text">1.1 ä¼ ç»Ÿæ¨¡å‹çš„é—®é¢˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar-%E7%9A%84%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87"><span class="nav-text">1.2 ContextVar çš„è®¾è®¡ç›®æ ‡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8Ccontextvar-%E7%9A%84%E6%8A%BD%E8%B1%A1%E6%A8%A1%E5%9E%8B"><span class="nav-text">äºŒã€ContextVar çš„æŠ½è±¡æ¨¡å‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-text">2.1 æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%BB%93%E6%9E%84"><span class="nav-text">2.2 æŠ½è±¡ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89contextvar-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%9C%BA%E5%88%B6"><span class="nav-text">ä¸‰ã€ContextVar çš„åº•å±‚å®ç°æœºåˆ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#context-%E6%9C%AC%E8%B4%A8%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-text">3.1 Context æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#context-%E6%98%AF%E6%80%8E%E4%B9%88%E8%B7%9F%E7%9D%80%E5%8D%8F%E7%A8%8B%E8%B7%91%E7%9A%84"><span class="nav-text">3.2 Context
æ˜¯æ€ä¹ˆâ€è·Ÿç€åç¨‹è·‘â€çš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B%E5%88%9B%E5%BB%BA%E6%97%B6"><span class="nav-text">åç¨‹åˆ›å»ºæ—¶</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar.set-%E5%88%B0%E5%BA%95%E5%81%9A%E4%BA%86%E4%BB%80%E4%B9%88"><span class="nav-text">3.3 ContextVar.set()
åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar.get-%E6%80%8E%E4%B9%88%E5%8F%96%E5%80%BC"><span class="nav-text">3.4 ContextVar.get() æ€ä¹ˆå–å€¼ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#context-%E5%88%87%E6%8D%A2%E6%98%AF%E6%80%8E%E4%B9%88%E5%8F%91%E7%94%9F%E7%9A%84"><span class="nav-text">3.5 Context åˆ‡æ¢æ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E4%B8%8E-java-threadlocal-%E7%9A%84%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB"><span class="nav-text">å››ã€ä¸ Java ThreadLocal
çš„æœ¬è´¨åŒºåˆ«</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E5%B7%AE%E5%BC%82%E5%AF%B9%E6%AF%94"><span class="nav-text">4.1 æ ¸å¿ƒå·®å¼‚å¯¹æ¯”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%80%BB%E7%BB%93"><span class="nav-text">4.2 ä¸€å¥è¯æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94threadlocal-%E7%9A%84%E7%9C%9F%E5%AE%9E%E5%B7%A5%E4%BD%9C%E6%96%B9%E5%BC%8F"><span class="nav-text">äº”ã€ThreadLocal
çš„çœŸå®å·¥ä½œæ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#threadlocal-%E5%B9%B6%E4%B8%8D%E5%AD%98%E5%80%BC"><span class="nav-text">5.1 ThreadLocal å¹¶ä¸â€å­˜å€¼â€</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#threadlocal-%E7%9A%84%E8%87%B4%E5%91%BD%E5%89%8D%E6%8F%90"><span class="nav-text">5.2 ThreadLocal çš„è‡´å‘½å‰æ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E7%8E%B0%E4%BB%A3-java-%E9%87%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E5%87%BA%E9%97%AE%E9%A2%98"><span class="nav-text">5.3 åœ¨ç°ä»£ Java
é‡Œä¸ºä»€ä¹ˆå‡ºé—®é¢˜ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A4%8D%E7%94%A8"><span class="nav-text">â‘  çº¿ç¨‹æ± å¤ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5%E6%A8%A1%E5%9E%8Bcompletablefuture-reactor"><span class="nav-text">â‘¡ å¼‚æ­¥æ¨¡å‹ï¼ˆCompletableFuture
&#x2F; Reactorï¼‰</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E9%80%9A%E4%BF%97%E7%90%86%E8%A7%A3threadlocal-vs-contextvar"><span class="nav-text">å…­ã€é€šä¿—ç†è§£ï¼šThreadLocal
vs ContextVar</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%A7%E7%99%BD%E8%AF%9D%E5%8C%BA%E5%88%86"><span class="nav-text">6.1 å¤§ç™½è¯åŒºåˆ†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%B7%AE%E5%BC%82"><span class="nav-text">6.2 å…³é”®å·®å¼‚</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%B4%E8%A7%82%E7%9A%84%E7%B1%BB%E6%AF%94"><span class="nav-text">6.3 ç›´è§‚çš„ç±»æ¯”</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#threadlocal-%E5%83%8F%E4%BB%80%E4%B9%88"><span class="nav-text">ThreadLocal åƒä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#contextvar-%E5%83%8F%E4%BB%80%E4%B9%88"><span class="nav-text">ContextVar åƒä»€ä¹ˆï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%83%E4%B8%BA%E4%BB%80%E4%B9%88-java-%E9%A1%B9%E7%9B%AE%E4%B9%A0%E6%83%AF%E7%94%A8-threadlocal-%E5%AD%98-user"><span class="nav-text">ä¸ƒã€ä¸ºä»€ä¹ˆ Java
é¡¹ç›®â€ä¹ æƒ¯ç”¨ ThreadLocal å­˜ userâ€ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AB%E7%8E%B0%E4%BB%A3%E6%A8%A1%E5%9E%8B%E7%9A%84%E6%8C%91%E6%88%98"><span class="nav-text">å…«ã€ç°ä»£æ¨¡å‹çš„æŒ‘æˆ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E4%BB%A5%E8%BF%99%E6%A0%B7%E8%B7%9F-java-%E5%90%8C%E4%BA%8B%E8%AF%B4"><span class="nav-text">8.1 å¯ä»¥è¿™æ ·è·Ÿ Java åŒäº‹è¯´ï¼š</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B9%9D%E5%8D%8F%E7%A8%8B%E7%BA%A7%E5%88%AB%E5%AD%98%E5%82%A8%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-text">ä¹ã€åç¨‹çº§åˆ«å­˜å‚¨çš„å®ç°</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%83%BD%E4%B8%8D%E8%83%BD%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%8D%8F%E7%A8%8B%E7%BA%A7%E5%88%AB%E7%9A%84%E5%AD%98%E5%82%A8"><span class="nav-text">9.1
èƒ½ä¸èƒ½å®ç°ä¸€ä¸ªâ€åç¨‹çº§åˆ«çš„å­˜å‚¨â€ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8D%8F%E7%A8%8B%E7%BA%A7%E5%88%AB%E5%AD%98%E5%82%A8%E4%B8%8D%E6%98%AF-threadlocal-%E5%8D%87%E7%BA%A7%E7%89%88"><span class="nav-text">9.2
ä¸ºä»€ä¹ˆâ€åç¨‹çº§åˆ«å­˜å‚¨â€ä¸æ˜¯ ThreadLocal å‡çº§ç‰ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9C%9F%E6%AD%A3%E7%9A%84%E9%9A%BE%E7%82%B9"><span class="nav-text">9.3 çœŸæ­£çš„éš¾ç‚¹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9-1%E4%BD%A0%E6%80%8E%E4%B9%88%E6%8B%BF%E5%88%B0%E5%BD%93%E5%89%8D%E5%8D%8F%E7%A8%8B%E6%98%AF%E8%B0%81"><span class="nav-text">â— éš¾ç‚¹
1ï¼šä½ æ€ä¹ˆæ‹¿åˆ°â€å½“å‰åç¨‹æ˜¯è°â€ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9-2%E5%8D%8F%E7%A8%8B%E5%88%87%E6%8D%A2%E6%97%B6%E8%B0%81%E5%B8%AE%E4%BD%A0%E5%88%87%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-text">â— éš¾ç‚¹
2ï¼šåç¨‹åˆ‡æ¢æ—¶ï¼Œè°å¸®ä½ åˆ‡ä¸Šä¸‹æ–‡ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9A%BE%E7%82%B9-3%E5%AD%90%E5%8D%8F%E7%A8%8B%E7%9A%84%E4%B8%8A%E4%B8%8B%E6%96%87%E7%BB%A7%E6%89%BF%E8%AF%AD%E4%B9%89"><span class="nav-text">â— éš¾ç‚¹
3ï¼šå­åç¨‹çš„â€ä¸Šä¸‹æ–‡ç»§æ‰¿â€è¯­ä¹‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%B0%E5%AE%9E%E4%B8%96%E7%95%8C%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%AD%94%E6%A1%88"><span class="nav-text">9.4 ç°å®ä¸–ç•Œçš„â€æ­£ç¡®ç­”æ¡ˆâ€</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pythoncontextvar"><span class="nav-text">1ï¸âƒ£ Pythonï¼šContextVar</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E6%96%B0%E6%97%B6%E4%BB%A3%E7%9A%84%E7%AD%94%E6%A1%88loom-scopedvalue"><span class="nav-text">2ï¸âƒ£ Java æ–°æ—¶ä»£çš„ç­”æ¡ˆï¼šLoom +
ScopedValue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#go%E7%9B%B4%E6%8E%A5%E5%86%85%E5%BB%BA%E5%88%B0-runtime"><span class="nav-text">3ï¸âƒ£ Goï¼šç›´æ¥å†…å»ºåˆ° runtime</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81threadlocal-%E7%9A%84%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2%E9%A3%8E%E9%99%A9"><span class="nav-text">åã€ThreadLocal
çš„å†…å­˜æ³„éœ²é£é™©</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E7%BB%93%E8%AE%BA"><span class="nav-text">10.1 ä¸€å¥è¯ç»“è®º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#threadlocal-%E7%9A%84%E7%9C%9F%E5%AE%9E%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="nav-text">10.2 ThreadLocal çš„çœŸå®å­˜å‚¨ç»“æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#threadlocal-%E5%B9%B6%E4%B8%8D%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="nav-text">ThreadLocal å¹¶ä¸å­˜æ•°æ®</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%84%E9%9C%B2%E6%98%AF%E6%80%8E%E4%B9%88%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E5%8F%91%E7%94%9F%E7%9A%84"><span class="nav-text">10.3 æ³„éœ²æ˜¯æ€ä¹ˆä¸€æ­¥ä¸€æ­¥å‘ç”Ÿçš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC-1-%E6%AD%A5%E4%BD%A0%E5%88%9B%E5%BB%BA%E4%BA%86-threadlocal"><span class="nav-text">ğŸ§© ç¬¬ 1 æ­¥ï¼šä½ åˆ›å»ºäº†
ThreadLocal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC-2-%E6%AD%A5%E6%96%B9%E6%B3%95%E7%BB%93%E6%9D%9Fthreadlocal-%E5%8F%98%E9%87%8F%E6%B6%88%E5%A4%B1"><span class="nav-text">ğŸ§© ç¬¬ 2
æ­¥ï¼šæ–¹æ³•ç»“æŸï¼ŒThreadLocal å˜é‡æ¶ˆå¤±</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC-3-%E6%AD%A5%E7%BA%BF%E7%A8%8B%E8%BF%98%E6%B4%BB%E7%9D%80%E7%BA%BF%E7%A8%8B%E6%B1%A0"><span class="nav-text">ğŸ§© ç¬¬ 3 æ­¥ï¼šçº¿ç¨‹è¿˜æ´»ç€ï¼ˆçº¿ç¨‹æ± ï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%BA%BF%E7%A8%8B%E6%B1%A0%E4%BC%9A%E6%8A%8A%E9%97%AE%E9%A2%98%E6%94%BE%E5%A4%A7-100-%E5%80%8D"><span class="nav-text">10.4 ä¸ºä»€ä¹ˆçº¿ç¨‹æ± ä¼šæŠŠé—®é¢˜æ”¾å¤§
100 å€ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-contextvar-scopedvalue-%E4%B8%8D%E4%BC%9A%E8%BF%99%E6%A0%B7"><span class="nav-text">10.5 ä¸ºä»€ä¹ˆ ContextVar &#x2F;
ScopedValue ä¸ä¼šè¿™æ ·ï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E9%93%BE%E7%9A%84%E6%AD%A3%E7%A1%AE%E7%90%86%E8%A7%A3"><span class="nav-text">åä¸€ã€å¼‚æ­¥&#x2F;ä»»åŠ¡é“¾çš„æ­£ç¡®ç†è§£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-1"><span class="nav-text">11.1 æ ¸å¿ƒæ¦‚å¿µ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E4%B8%AA%E5%85%B3%E9%94%AE%E6%A6%82%E5%BF%B5"><span class="nav-text">11.2 ä¸‰ä¸ªå…³é”®æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8Bthread"><span class="nav-text">1ï¸âƒ£ çº¿ç¨‹ï¼ˆThreadï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8Bcoroutine-task-fiber"><span class="nav-text">2ï¸âƒ£ åç¨‹ï¼ˆCoroutine &#x2F; Task &#x2F;
Fiberï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5-%E4%BB%BB%E5%8A%A1%E9%93%BE"><span class="nav-text">3ï¸âƒ£ å¼‚æ­¥ &#x2F; ä»»åŠ¡é“¾</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-threadlocal-%E5%9C%A8%E8%BF%99%E9%87%8C%E5%B0%B1%E4%B8%8D%E8%A1%8C%E4%BA%86"><span class="nav-text">11.3 ä¸ºä»€ä¹ˆ ThreadLocal
åœ¨è¿™é‡Œå°±ä¸è¡Œäº†ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contextvar-scopedvalue-%E6%98%AF%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3%E4%BB%BB%E5%8A%A1%E9%93%BE%E7%9A%84"><span class="nav-text">11.4 ContextVar &#x2F;
ScopedValue æ˜¯æ€ä¹ˆç†è§£â€ä»»åŠ¡é“¾â€çš„ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%B8%80%E5%8F%A5%E8%AF%9D"><span class="nav-text">æ ¸å¿ƒä¸€å¥è¯ï¼š</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pythoncontextvar-1"><span class="nav-text">Pythonï¼ˆContextVarï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-loomscopedvalue"><span class="nav-text">Java Loomï¼ˆScopedValueï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%9E%E5%B8%B8%E5%85%B3%E9%94%AE%E7%9A%84%E4%B8%80%E7%82%B9"><span class="nav-text">11.5 éå¸¸å…³é”®çš„ä¸€ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8llm-%E8%B0%83%E7%94%A8%E9%93%BE%E8%BF%BD%E8%B8%AA"><span class="nav-text">åäºŒã€å®æˆ˜åº”ç”¨ï¼šLLM è°ƒç”¨é“¾è¿½è¸ª</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%87%E5%87%86%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%BC%8F"><span class="nav-text">12.1 æ ‡å‡†å®ç°æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-text">12.2 ä½¿ç”¨ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%98%E5%8A%BF%E4%BD%93%E7%8E%B0"><span class="nav-text">12.3 ä¼˜åŠ¿ä½“ç°</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%81%E4%B8%89%E6%80%BB%E7%BB%93%E4%B8%8E%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE"><span class="nav-text">åä¸‰ã€æ€»ç»“ä¸é€‰å‹å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E8%A6%81%E7%82%B9%E5%9B%9E%E9%A1%BE"><span class="nav-text">13.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E5%9E%8B%E5%BB%BA%E8%AE%AE"><span class="nav-text">13.2 é€‰å‹å»ºè®®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9-contextvarpython"><span class="nav-text">é€‰æ‹© ContextVarï¼ˆPythonï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9-threadlocaljava"><span class="nav-text">é€‰æ‹© ThreadLocalï¼ˆJavaï¼‰</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-threadlocaljava"><span class="nav-text">é¿å…ä½¿ç”¨ ThreadLocalï¼ˆJavaï¼‰</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%80%E7%BB%88%E5%88%A4%E6%96%AD%E6%A0%87%E5%87%86"><span class="nav-text">13.3 æœ€ç»ˆåˆ¤æ–­æ ‡å‡†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%97%B6%E4%BB%A3%E6%80%BB%E7%BB%93"><span class="nav-text">13.4 ä¸€å¥è¯æ—¶ä»£æ€»ç»“</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>





<!-- common js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/utils.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/header-shrink.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/back2top.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/toggle-theme.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/code-block.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/main.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/libs/anime.min.js"></script>

<!-- local search -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/local-search.min.js"></script>


<!-- lazyload -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/lazyload.min.js"></script>


<div class="">
    <!-- home page -->
    

    <!-- post page -->
    
        <!-- post-helper -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/post/post-helper.min.js"></script>

        <!-- toc -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/post/toc.min.js"></script>
        

        <!-- copyright-info -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/post/copyright-info.min.js"></script>
        

        <!-- share -->
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-theme-keep/4.2.5/js/post/share.min.js"></script>
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



    
        
    
        
            
<script class="custom-inject-js" src="/js/custom_code_block.js" data-pjax></script>

        
    

</body>
</html>
